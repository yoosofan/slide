<html xmlns="http://www.w3.org/1999/xhtml"><head><title></title><meta charset="UTF-8"><meta name="generator" content="prezentprogramo 1.0 https://github.com/yoosofan/prezentprogramo"><link rel="stylesheet" href="css/hovercraft.css" media="all"><link rel="stylesheet" href="css/highlight.css" media="all"><link rel="stylesheet" href="css/style.css" media="all"><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-width="1024" data-height="800" data-transition-duration="1000"><div class="step step-level-1" step="0" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="lexical-analyzer">Lexical Analyzer</h1><h2 id="sly-sly-lex-yacc">SLY (Sly Lex-Yacc)</h2><p>Ahmad Yoosofan</p><p>Compiler course</p><p>University of Kashan</p><ul><li><a href="https://yoosofan.github.io/course/compiler.html">https://yoosofan.github.io/course/compiler.html</a></li></ul></div><div class="step step-level-1" step="1" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="sly">Sly</h1><ul><li><a href="https://github.com/dabeaz/sly">https://github.com/dabeaz/sly</a></li><li><a href="https://sly.readthedocs.io/en/latest/">https://sly.readthedocs.io/en/latest/</a></li><li>zero-dependency Python implementation of the traditional parsing tools lex and yacc</li><li>Using Python Langauge which is very good at text processing.</li><li>SLY provides very extensive error reporting and diagnostic information to assist in parser construction.</li><li>SLY provides full support for empty productions, error recovery, precedence specifiers, and moderately ambiguous grammars.</li><li>SLY uses various Python metaprogramming features to specify lexers and parsers.</li><li>A moderinized form of PLY (It is not follow the same rule of old Lex/Yacc)</li><li>SLY requires the use of Python 3.6 or greater.</li><li>3-BSD like license</li></ul><h2 id="install-sly">Install SLY</h2><pre class="highlight code console"><span class="gp"># </span>install<span class="w"> </span>python<span class="w"> </span><span class="o">(</span>already<span class="w"> </span>installed<span class="w"> </span><span class="k">in</span><span class="w"> </span>most<span class="w"> </span>Linux<span class="o">)</span><span class="w">
</span><span class="gp"># </span>install<span class="w"> </span>pip3<span class="w">
</span><span class="gp"># </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>python3-pip<span class="w"> </span><span class="c1"># for Debian and Ubuntu
</span><span class="go">
pip3 install sly

</span><span class="gp"># </span>or<span class="w"> </span>just<span class="w"> </span>copy<span class="w"> </span>sly<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>folder<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>project</pre></div><div class="step step-level-1 t2c" step="2" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="simple-lexer-code">Simple Lexer Code</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">NUMBER</span> <span class="o">=</span>  <span class="sa">r</span><span class="s1">'[0-9]+'</span> <span class="c1">#\d+</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'3 + 42 +8'</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln">1 </span><span class="go">python3 222.plus.py
</span><span class="ln">2 </span><span class="go">
</span><span class="ln">3 </span><span class="go">type='NUMBER', value='3'
</span><span class="ln">4 </span><span class="go">type='PLUS', value='+'
</span><span class="ln">5 </span><span class="go">type='NUMBER', value='42'
</span><span class="ln">6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln">7 </span><span class="go">type='NUMBER', value='8'</span></pre></div><div class="step step-level-1 t2c" step="3" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="simple-error-handling">Simple Error handling</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">NUMBER</span> <span class="o">=</span>  <span class="sa">r</span><span class="s1">'[0-9]+'</span> <span class="c1">#\d+</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'3 + 42 +8.43+456'</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 233.error.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='NUMBER', value='3'
</span><span class="ln"> 4 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value='42'
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value='8'
</span><span class="ln"> 8 </span><span class="go">Illegal character '.'
</span><span class="ln"> 9 </span><span class="go">type='NUMBER', value='43'
</span><span class="ln">10 </span><span class="go">type='PLUS', value='+'
</span><span class="ln">11 </span><span class="go">type='NUMBER', value='456'</span></pre></div><div class="step step-level-1 t2c" step="4" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="converting-value-based-on-type">Converting Value Based on Type</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">NUMBER</span> <span class="o">=</span>  <span class="sa">r</span><span class="s1">'\d+'</span> <span class="c1">#[0-9]+</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'number:'</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">15 </span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">19 </span><span class="w">
</span><span class="ln">20 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'3 + 42 +8'</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 244.plus.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">number: 3
</span><span class="ln"> 4 </span><span class="go">type='NUMBER', value=3
</span><span class="ln"> 5 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 6 </span><span class="go">number: 42
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value=42
</span><span class="ln"> 8 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 9 </span><span class="go">number: 8
</span><span class="ln">10 </span><span class="go">type='NUMBER', value=8</span></pre></div><div class="step step-level-1 t2c" step="5" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="index-of-token-in-buffer">Index of Token in Buffer</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">NUMBER</span> <span class="o">=</span>  <span class="sa">r</span><span class="s1">'\d+'</span> <span class="c1">#[0-9]+</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">18 </span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'3 + 42 +8'</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">, index=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>      <span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln">1 </span><span class="go">python3 255.index.py
</span><span class="ln">2 </span><span class="go">
</span><span class="ln">3 </span><span class="go">type='NUMBER', value=3, index=0
</span><span class="ln">4 </span><span class="go">type='PLUS', value='+', index=2
</span><span class="ln">5 </span><span class="go">type='NUMBER', value=42, index=4
</span><span class="ln">6 </span><span class="go">type='PLUS', value='+', index=7
</span><span class="ln">7 </span><span class="go">type='NUMBER', value=8, index=8</span></pre></div><div class="step step-level-1 t2c" step="6" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="just-number-function">Just Number Function</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">9 </span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">18 </span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'3 + 42 +8'</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">, index=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>      <span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln">1 </span><span class="go">python3 264.just.number.function.py
</span><span class="ln">2 </span><span class="go">
</span><span class="ln">3 </span><span class="go">type='NUMBER', value=3, index=0
</span><span class="ln">4 </span><span class="go">type='PLUS', value='+', index=2
</span><span class="ln">5 </span><span class="go">type='NUMBER', value=42, index=4
</span><span class="ln">6 </span><span class="go">type='PLUS', value='+', index=7
</span><span class="ln">7 </span><span class="go">type='NUMBER', value=8, index=8</span></pre></div><div class="step step-level-1 t2c" step="7" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="ignore-new-line-and-one-line-comment">Ignore New Line and One Line Comment</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">ignore_comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\#.*'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">ignore_newline</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\n+'</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">17 </span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">21 </span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'''3 + 42 +8 # First comment
</span><span class="ln">24 </span><span class="s1">    + 46+980+51+# Another commnet
</span><span class="ln">25 </span><span class="s1">    343+43
</span><span class="ln">26 </span><span class="s1">  '''</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">, index=</span><span class="si">%r</span><span class="s1">'</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>       <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 274.ignore.lines.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='NUMBER', value=3, index=0
</span><span class="ln"> 4 </span><span class="go">type='PLUS', value='+', index=2
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value=42, index=4
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+', index=7
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value=8, index=8
</span><span class="ln"> 8 </span><span class="go">type='PLUS', value='+', index=30
</span><span class="ln"> 9 </span><span class="go">type='NUMBER', value=46, index=32
</span><span class="ln">10 </span><span class="go">type='PLUS', value='+', index=34
</span><span class="ln">11 </span><span class="go">type='NUMBER', value=980, index=35
</span><span class="ln">12 </span><span class="go">type='PLUS', value='+', index=38
</span><span class="ln">13 </span><span class="go">type='NUMBER', value=51, index=39
</span><span class="ln">14 </span><span class="go">type='PLUS', value='+', index=41
</span><span class="ln">15 </span><span class="go">type='NUMBER', value=343, index=64
</span><span class="ln">16 </span><span class="go">type='PLUS', value='+', index=67
</span><span class="ln">17 </span><span class="go">type='NUMBER', value=43, index=68</span></pre></div><div class="step step-level-1 t2c" step="8" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="counting-lines-error">Counting Lines (Error)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span><span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">ignore_comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\#.*'</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">ignore_newline</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\n+'</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">17 </span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">21 </span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'''3 + 42 +8 # First comment
</span><span class="ln">24 </span><span class="s1">    + 46+980+51+# Another commnet
</span><span class="ln">25 </span><span class="s1">    343+43
</span><span class="ln">26 </span><span class="s1">  '''</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">, index=</span><span class="si">%r</span><span class="s1">, lineno=</span><span class="si">%r</span><span class="s1">'</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>       <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 280.lineno.wrong.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='NUMBER', value=3, index=0, lineno=1
</span><span class="ln"> 4 </span><span class="go">type='PLUS', value='+', index=2, lineno=1
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value=42, index=4, lineno=1
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+', index=7, lineno=1
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value=8, index=8, lineno=1
</span><span class="ln"> 8 </span><span class="go">type='PLUS', value='+', index=30, lineno=1
</span><span class="ln"> 9 </span><span class="go">type='NUMBER', value=46, index=32, lineno=1
</span><span class="ln">10 </span><span class="go">type='PLUS', value='+', index=34, lineno=1
</span><span class="ln">11 </span><span class="go">type='NUMBER', value=980, index=35, lineno=1
</span><span class="ln">12 </span><span class="go">type='PLUS', value='+', index=38, lineno=1
</span><span class="ln">13 </span><span class="go">type='NUMBER', value=51, index=39, lineno=1
</span><span class="ln">14 </span><span class="go">type='PLUS', value='+', index=41, lineno=1
</span><span class="ln">15 </span><span class="go">type='NUMBER', value=343, index=64, lineno=1
</span><span class="ln">16 </span><span class="go">type='PLUS', value='+', index=67, lineno=1
</span><span class="ln">17 </span><span class="go">type='NUMBER', value=43, index=68, lineno=1</span></pre></div><div class="step step-level-1 t2c" step="9" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="line-number-of-tokens">Line Number of Tokens</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">ignore_comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\#.*'</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="c1"># Line number tracking</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\n+'</span><span class="p">)</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">ignore_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span><span class="w">
</span><span class="ln">17 </span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">21 </span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'''3 + 42 +8 # First comment
</span><span class="ln">24 </span><span class="s1">    + 46+980+51+# Another commnet
</span><span class="ln">25 </span><span class="s1">    343+43
</span><span class="ln">26 </span><span class="s1">  '''</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">, index=</span><span class="si">%r</span><span class="s1">, lineno=</span><span class="si">%r</span><span class="s1">'</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>       <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 284.lineno.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='NUMBER', value=3, index=0, lineno=1
</span><span class="ln"> 4 </span><span class="go">type='PLUS', value='+', index=2, lineno=1
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value=42, index=4, lineno=1
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+', index=7, lineno=1
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value=8, index=8, lineno=1
</span><span class="ln"> 8 </span><span class="go">type='PLUS', value='+', index=30, lineno=2
</span><span class="ln"> 9 </span><span class="go">type='NUMBER', value=46, index=32, lineno=2
</span><span class="ln">10 </span><span class="go">type='PLUS', value='+', index=34, lineno=2
</span><span class="ln">11 </span><span class="go">type='NUMBER', value=980, index=35, lineno=2
</span><span class="ln">12 </span><span class="go">type='PLUS', value='+', index=38, lineno=2
</span><span class="ln">13 </span><span class="go">type='NUMBER', value=51, index=39, lineno=2
</span><span class="ln">14 </span><span class="go">type='PLUS', value='+', index=41, lineno=2
</span><span class="ln">15 </span><span class="go">type='NUMBER', value=343, index=64, lineno=3
</span><span class="ln">16 </span><span class="go">type='PLUS', value='+', index=67, lineno=3
</span><span class="ln">17 </span><span class="go">type='NUMBER', value=43, index=68, lineno=3</span></pre></div><div class="step step-level-1 t2c" step="10" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="token-remapping">Token Remapping</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">IF</span><span class="p">,</span> <span class="n">ELSE</span><span class="p">,</span> <span class="n">WHILE</span><span class="p">}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">ignore_comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\#.*'</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="n">ID</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="c1"># Special cases</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="n">ID</span><span class="p">[</span><span class="s1">'if'</span><span class="p">]</span> <span class="o">=</span> <span class="n">IF</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">ID</span><span class="p">[</span><span class="s1">'else'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ELSE</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="n">ID</span><span class="p">[</span><span class="s1">'while'</span><span class="p">]</span> <span class="o">=</span> <span class="n">WHILE</span>  <span class="w">
</span><span class="ln">13 </span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">18 </span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="c1"># Line number tracking</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\n+'</span><span class="p">)</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">ignore_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span><span class="w">
</span><span class="ln">23 </span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Illegal character '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">27 </span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'count+ if +ifelse+8+while # First comment'</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">32 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 322.token.remapping.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='count'
</span><span class="ln"> 4 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 5 </span><span class="go">type='IF', value='if'
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='ID', value='ifelse'
</span><span class="ln"> 8 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 9 </span><span class="go">type='NUMBER', value=8
</span><span class="ln">10 </span><span class="go">type='PLUS', value='+'
</span><span class="ln">11 </span><span class="go">type='WHILE', value='while'</span></pre></div><div class="step step-level-1 t2c" step="11" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="more-token-type">More Token Type</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="c1"># Set of token names.   </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="c1"># This is always required</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">,</span> <span class="n">MINUS</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>             <span class="n">DIVIDE</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">LPAREN</span><span class="p">,</span> <span class="n">RPAREN</span> <span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="c1"># String containing ignored characters</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="c1"># between tokens</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="c1"># Regular expression rules for tokens</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="n">NUMBER</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\d+'</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="n">MINUS</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'-'</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="n">TIMES</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'\*'</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="n">DIVIDE</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'/'</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">LPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\('</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="n">RPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\)'</span><span class="w">
</span><span class="ln">23 </span><span class="w">
</span><span class="ln">24 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x = 3 + 42 * (s - t)'</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 524.more.tokens.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value='3'
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value='42'
</span><span class="ln"> 8 </span><span class="go">type='TIMES', value='*'
</span><span class="ln"> 9 </span><span class="go">type='LPAREN', value='('
</span><span class="ln">10 </span><span class="go">type='ID', value='s'
</span><span class="ln">11 </span><span class="go">type='MINUS', value='-'
</span><span class="ln">12 </span><span class="go">type='ID', value='t'
</span><span class="ln">13 </span><span class="go">type='RPAREN', value=')'</span></pre></div><div class="step step-level-1 t2c" step="12" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="longer-tokens-before-short-tokens">Longer Tokens before Short Tokens</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="c1"># Set of token names.   </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="c1"># This is always required</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">,</span> <span class="n">MINUS</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">DIVIDE</span><span class="p">,</span> <span class="n">LPAREN</span><span class="p">,</span> <span class="n">RPAREN</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">EQ</span> <span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="c1"># String containing ignored characters</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="c1"># between tokens</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="c1"># Regular expression rules for tokens</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="n">NUMBER</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\d+'</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="n">MINUS</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'-'</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="n">TIMES</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'\*'</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="n">DIVIDE</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'/'</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="n">EQ</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'=='</span>  <span class="c1"># MUST APPEAR FIRST! (LONGER)</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="n">LPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\('</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="n">RPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\)'</span><span class="w">
</span><span class="ln">24 </span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x = 3 + 42 * (s == t)'</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 544.longer.before.shorter.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value='3'
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value='42'
</span><span class="ln"> 8 </span><span class="go">type='TIMES', value='*'
</span><span class="ln"> 9 </span><span class="go">type='LPAREN', value='('
</span><span class="ln">10 </span><span class="go">type='ID', value='s'
</span><span class="ln">11 </span><span class="go">type='EQ', value='=='
</span><span class="ln">12 </span><span class="go">type='ID', value='t'
</span><span class="ln">13 </span><span class="go">type='RPAREN', value=')'</span></pre></div><div class="step step-level-1 t2c" step="13" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="longer-tokens-before-short-tokens-error">Longer Tokens before Short Tokens(Error)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="c1"># Set of token names.   </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="c1"># This is always required</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">,</span> <span class="n">MINUS</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">DIVIDE</span><span class="p">,</span> <span class="n">LPAREN</span><span class="p">,</span> <span class="n">RPAREN</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">EQ</span> <span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="c1"># String containing ignored characters</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="c1"># between tokens</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="c1"># Regular expression rules for tokens</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="n">NUMBER</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\d+'</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="n">MINUS</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'-'</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="n">TIMES</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">'\*'</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="n">DIVIDE</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'/'</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="n">EQ</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'=='</span>  <span class="c1"># MUST APPEAR FIRST! (LONGER)  </span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>  <span class="n">LPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\('</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="n">RPAREN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'\)'</span><span class="w">
</span><span class="ln">24 </span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x = 3 + 42 * (s == t)'</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 555.longer.before.shorter.error.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value='3'
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value='42'
</span><span class="ln"> 8 </span><span class="go">type='TIMES', value='*'
</span><span class="ln"> 9 </span><span class="go">type='LPAREN', value='('
</span><span class="ln">10 </span><span class="go">type='ID', value='s'
</span><span class="ln">11 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln">12 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln">13 </span><span class="go">type='ID', value='t'
</span><span class="ln">14 </span><span class="go">type='RPAREN', value=')'</span></pre></div><div class="step step-level-1 t2c" step="14" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="adding-match-actions">Adding Match Actions</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="c1"># Set of token names.   </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="c1"># This is always required</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">PLUS</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">EQ</span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="c1"># String containing ignored characters</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="c1"># between tokens</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="c1"># Regular expression rules for tokens</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="n">PLUS</span>    <span class="o">=</span> <span class="sa">r</span><span class="s1">'\+'</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="n">EQ</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'=='</span>  <span class="c1"># MUST APPEAR FIRST! (LONGER)  </span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'0x[0-9a-fA-F]+'</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'0x'</span><span class="p">):</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>      <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>    <span class="k">else</span><span class="p">:</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>      <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>    <span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x = 3 + 0xa2 33ab  s == t'</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 575.adding.match.actions.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 5 </span><span class="go">type='NUMBER', value=3
</span><span class="ln"> 6 </span><span class="go">type='PLUS', value='+'
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value=162
</span><span class="ln"> 8 </span><span class="go">type='NUMBER', value=33
</span><span class="ln"> 9 </span><span class="go">type='ID', value='ab'
</span><span class="ln">10 </span><span class="go">type='TIMES', value='*'
</span><span class="ln">11 </span><span class="go">type='LPAREN', value='('
</span><span class="ln">12 </span><span class="go">type='ID', value='s'
</span><span class="ln">13 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln">14 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln">15 </span><span class="go">type='ID', value='t'
</span><span class="ln">16 </span><span class="go">type='RPAREN', value=')'</span></pre></div><div class="step step-level-1 t2c" step="15" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="literals-i">Literals(I)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">literals</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span> <span class="s1">'('</span><span class="p">,</span> <span class="s1">')'</span><span class="p">}</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">NUMBER</span>  <span class="o">=</span> <span class="s1">'\d+'</span><span class="w">
</span><span class="ln">9 </span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x += (234+d t) aa)'</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 584.literal.I.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='+', value='+'
</span><span class="ln"> 5 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 6 </span><span class="go">type='(', value='('
</span><span class="ln"> 7 </span><span class="go">type='NUMBER', value='234'
</span><span class="ln"> 8 </span><span class="go">type='+', value='+'
</span><span class="ln"> 9 </span><span class="go">type='ID', value='d'
</span><span class="ln">10 </span><span class="go">type='ID', value='t'
</span><span class="ln">11 </span><span class="go">type=')', value=')'
</span><span class="ln">12 </span><span class="go">type='ID', value='aa'
</span><span class="ln">13 </span><span class="go">type=')', value=')'</span></pre></div><div class="step step-level-1 t2c" step="16" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="literals-ii-do-something">Literals(II) - Do Something</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">sly</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lexer</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">ID</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">literals</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'{'</span><span class="p">,</span> <span class="s1">'}'</span><span class="p">,</span> <span class="s1">'+'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span> <span class="s1">'('</span><span class="p">,</span> <span class="s1">')'</span><span class="p">}</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ID</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">NUMBER</span>  <span class="o">=</span> <span class="s1">'\d+'</span><span class="w">
</span><span class="ln">9 </span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting_level</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">11 </span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\{'</span><span class="p">)</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">lbrace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>    <span class="c1"># Set token type to the expected literal</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">'{'</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">nesting_level</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'nesting level: '</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting_level</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">19 </span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\}'</span><span class="p">)</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">rbrace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>    <span class="c1"># Set token type to the expected literal</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>    <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">'}'</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">nesting_level</span> <span class="o">-=</span><span class="mi">1</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'nesting level: '</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting_level</span><span class="p">)</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>    <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">27 </span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>  <span class="n">data</span> <span class="o">=</span> <span class="s1">'x += {s ( {t)} aa}'</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>  <span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span>  <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">32 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">, value=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 588.literal.II.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go">type='ID', value='x'
</span><span class="ln"> 4 </span><span class="go">type='+', value='+'
</span><span class="ln"> 5 </span><span class="go">type='ASSIGN', value='='
</span><span class="ln"> 6 </span><span class="go">nesting level:  1
</span><span class="ln"> 7 </span><span class="go">type='{', value='{'
</span><span class="ln"> 8 </span><span class="go">type='ID', value='s'
</span><span class="ln"> 9 </span><span class="go">type='(', value='('
</span><span class="ln">10 </span><span class="go">nesting level:  2
</span><span class="ln">11 </span><span class="go">type='{', value='{'
</span><span class="ln">12 </span><span class="go">type='ID', value='t'
</span><span class="ln">13 </span><span class="go">type=')', value=')'
</span><span class="ln">14 </span><span class="go">nesting level:  1
</span><span class="ln">15 </span><span class="go">type='}', value='}'
</span><span class="ln">16 </span><span class="go">type='ID', value='aa'
</span><span class="ln">17 </span><span class="go">nesting level:  0
</span><span class="ln">18 </span><span class="go">type='}', value='}'</span></pre></div><div class="step step-level-1 t2c" step="17" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="complete-example">Complete Example</h1><pre class="highlight code python"><span class="ln">1 </span><span class="k">class</span><span class="w"> </span><span class="nc">CalcLexer</span><span class="p">(</span><span class="n">Lexer</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">INT</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">WHILE</span><span class="p">,</span> <span class="n">PRINT</span><span class="p">,</span> <span class="n">ASSIGN</span><span class="p">,</span> <span class="n">LT</span><span class="p">,</span> <span class="n">LE</span><span class="p">}</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">literals</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'('</span><span class="p">,</span> <span class="s1">')'</span><span class="p">,</span> <span class="s1">'{'</span><span class="p">,</span> <span class="s1">'}'</span><span class="p">,</span> <span class="s1">';'</span><span class="p">,</span> <span class="s1">'+'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">ignore</span> <span class="o">=</span> <span class="s1">' </span><span class="se">\t</span><span class="s1">'</span><span class="p">;</span>  <span class="n">ignore_comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\#.*'</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">ID</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*'</span><span class="p">;</span> <span class="n">ID</span><span class="p">[</span><span class="s1">'while'</span><span class="p">]</span> <span class="o">=</span> <span class="n">WHILE</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">ID</span><span class="p">[</span><span class="s1">'print'</span><span class="p">]</span> <span class="o">=</span> <span class="n">PRINT</span> <span class="c1"># ID['if'] = IF # ID['else'] = ELSE</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="n">ASSIGN</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">'='</span> <span class="c1">#  EQ = r'=='</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="n">LE</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'&lt;='</span> <span class="c1"># NE = r'!='</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="n">LT</span>      <span class="o">=</span> <span class="sa">r</span><span class="s1">'&lt;'</span> <span class="c1">#GE=r'&gt;='; GT=r'&gt;'</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+\.\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">FLOAT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">13 </span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">)</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">INT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="k">return</span> <span class="n">t</span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="nd">@_</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\n+'</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">ignore_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span><span class="w">
</span><span class="ln">19 </span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'Line </span><span class="si">%d</span><span class="s1">: Bad character </span><span class="si">%r</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln">23 </span><span class="w">
</span><span class="ln">24 </span><span class="w"></span><span class="n">data</span> <span class="o">=</span> <span class="s1">'''x = 0.1;
</span><span class="ln">25 </span><span class="s1">while (x &lt; 10) {
</span><span class="ln">26 </span><span class="s1">  print x: # Counting
</span><span class="ln">27 </span><span class="s1">  x = x + 1;
</span><span class="ln">28 </span><span class="s1">}'''</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span><span class="n">lexer</span> <span class="o">=</span> <span class="n">CalcLexer</span><span class="p">()</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span><span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span>  <span class="nb">print</span><span class="p">(</span><span class="s1">'('</span><span class="p">,</span><span class="n">tok</span><span class="o">.</span><span class="n">type</span><span class="p">,</span><span class="s1">','</span><span class="p">,</span><span class="n">tok</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="s1">','</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="s1">','</span><span class="p">,</span> <span class="w">
</span><span class="ln">32 </span><span class="w"></span>    <span class="n">tok</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="s1">')'</span><span class="p">)</span></pre><pre class="highlight code console substep"><span class="ln"> 1 </span><span class="go">python3 624.py
</span><span class="ln"> 2 </span><span class="go">
</span><span class="ln"> 3 </span><span class="go"></span><span class="gp-VirtualEnv">( ID , x , 1 , 0 )</span>
<span class="ln"> 4 </span><span class="go"></span><span class="gp-VirtualEnv">( ASSIGN , = , 1 , 2 )</span>
<span class="ln"> 5 </span><span class="go"></span><span class="gp-VirtualEnv">( FLOAT , 0.1 , 1 , 4 )</span>
<span class="ln"> 6 </span><span class="go"></span><span class="gp-VirtualEnv">( ; , ; , 1 , 7 )</span>
<span class="ln"> 7 </span><span class="go"></span><span class="gp-VirtualEnv">( WHILE , while , 2 , 9 )</span>
<span class="ln"> 8 </span><span class="go"></span><span class="gp-VirtualEnv">( ( , ( , 2 , 15 )</span>
<span class="ln"> 9 </span><span class="go"></span><span class="gp-VirtualEnv">( ID , x , 2 , 16 )</span>
<span class="ln">10 </span><span class="go"></span><span class="gp-VirtualEnv">( LT , &lt; , 2 , 18 )</span>
<span class="ln">11 </span><span class="go"></span><span class="gp-VirtualEnv">( INT , 10 , 2 , 20 )</span>
<span class="ln">12 </span><span class="go"></span><span class="gp-VirtualEnv">( )</span> <span class="go">, ) , 2 , 22 )
</span><span class="ln">13 </span><span class="go"></span><span class="gp-VirtualEnv">( { , { , 2 , 24 )</span>
<span class="ln">14 </span><span class="go"></span><span class="gp-VirtualEnv">( PRINT , print , 3 , 28 )</span>
<span class="ln">15 </span><span class="go"></span><span class="gp-VirtualEnv">( ID , x , 3 , 34 )</span>
<span class="ln">16 </span><span class="go">Line 3: Bad character ':'
</span><span class="ln">17 </span><span class="go"></span><span class="gp-VirtualEnv">( ID , x , 4 , 50 )</span>
<span class="ln">18 </span><span class="go"></span><span class="gp-VirtualEnv">( ASSIGN , = , 4 , 52 )</span>
<span class="ln">19 </span><span class="go"></span><span class="gp-VirtualEnv">( ID , x , 4 , 54 )</span>
<span class="ln">20 </span><span class="go"></span><span class="gp-VirtualEnv">( + , + , 4 , 56 )</span>
<span class="ln">21 </span><span class="go"></span><span class="gp-VirtualEnv">( INT , 1 , 4 , 58 )</span>
<span class="ln">22 </span><span class="go"></span><span class="gp-VirtualEnv">( ; , ; , 4 , 59 )</span>
<span class="ln">23 </span><span class="go"></span><span class="gp-VirtualEnv">( } , } , 5 , 61 )</span>
<span class="ln">24 </span></pre></div><div class="step step-level-1" step="18" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="syntax-analysis-recursive-descendant">Syntax Analysis(Recursive Descendant)</h1></div></div><div id="slide-number" class="slide-number">
         1
      </div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript" src="js/MathJax/es5/tex-mml-chtml.js"></script><script type="text/javascript">
      document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
    </script></body></html>