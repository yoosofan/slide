<html xmlns="http://www.w3.org/1999/xhtml"><head><title></title><meta charset="UTF-8"><meta name="generator" content="prezentprogramo 1.0 https://github.com/yoosofan/prezentprogramo"><link rel="stylesheet" href="css/hovercraft.css" media="all"><link rel="stylesheet" href="css/highlight.css" media="all"><link rel="stylesheet" href="css/style.css" media="all"><link rel="stylesheet" href="css/ps.css" media="all"><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-width="1024" data-height="768" data-transition-duration="1000"><div class="step step-level-1" step="0" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="operating-systems-process-synchronization">Operating Systems: Process Synchronization</h1><h2 id="ahmad-yoosofan">Ahmad Yoosofan</h2><p><a href="https://yoosofan.github.io">https://yoosofan.github.io</a></p><p>University of Kashan</p></div><div class="step step-level-1" step="1" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="sharing-resources">Sharing Resources</h1><h2 id="critical-section">Critical Section</h2><p>Processes try to use resources simultaneously</p><ul><li class="substep">Sharing Physical Resources<ul><li class="substep">printer</li><li class="substep">scanner</li><li class="substep">etc.</li></ul></li><li class="substep">Sharing Logical Resources<ul><li class="substep">files<ul><li class="substep">read</li><li class="substep">write</li></ul></li><li class="substep">variables and arrays</li><li class="substep">lots of queues including Ready Queue</li></ul></li></ul></div><div class="step step-level-1" step="2" id="ps-desc-i-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="sharing-simple-variables-i">Sharing Simple Variables(I)</h1><p>Share code</p><pre class="highlight code cpp"><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></pre><p><span class="math ">\(p_0\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span></pre><p><span class="math ">\(p_1\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=5, y=3</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=7, y=3</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=7, y=5</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=5, y=3</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=7, y=3</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=7, y=5</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=5, y=3</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=5, y=3</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=5, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=5, y=3</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=5, y=3</li></ol></div><div class="step step-level-1" step="3" id="ps-desc-ii-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="sharing-simple-variables-ii">Sharing Simple Variables(II)</h1><p>Share code</p><pre class="highlight code cpp"><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></pre><p><span class="math ">\(p_0\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span></pre><p><span class="math ">\(p_1\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">;</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=2, y=4</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=7, y=4</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=7, y=12</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=4,  y=1</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=4,  y=9</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=10, y=9</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=10, y=12</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, y=1</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=4, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=4, y=6</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=4, y=9</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=4, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, y=1</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=2, y=4</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=2, y=7</li></ol></div><div class="step step-level-1" step="4" id="ps-mcode-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="machine-code">Machine code</h1><p>Share code</p><pre class="highlight code cpp"><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span></pre><p><span class="math ">\(p_0\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span></pre><p><span class="math ">\(p_1\)</span></p><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t2</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, t1=4</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=4, t1=4</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=4, t2=2</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=2, t2=2</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=2, t2=0</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=0, t2=0</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=0, t1=2</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=2, t1=2</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, t1=2</li><li class="substep"><span class="math ">\(P_1\)</span> 1: x=2, t2=0</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=2, t1=2</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=0, t2=0</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 1: x=2, t2=0</li><li class="substep"><span class="math ">\(P_0\)</span> 1: x=2, t1=4</li><li class="substep"><span class="math ">\(P_1\)</span> 2: x=0, t2=0</li><li class="substep"><span class="math ">\(P_0\)</span> 2: x=4, t1=4</li></ol></div><div class="step step-level-1" step="5" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="how-to-solve-race-condition">How to solve race condition</h1><ul><li class="substep">Putting Operating System in charge</li><li class="substep">Putting a process of Operating System in charge</li><li class="substep">Putting different processes in charge of different resoureces</li><li class="substep">No process in charge, just write codes the way to solve every race.</li></ul><h2 id="general-solutions">General Solutions</h2><ul><li class="substep"><em>Software solution</em> : (no need to change anything in current cpu)</li><li class="substep"><em>Hardware solution</em> : (need to add some instructions to cpu)</li></ul></div><div class="step step-level-1" step="6" id="simplyfing-race-conditions-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="simplifying">Simplifying</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="n">P0</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">Reminder</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">Remider</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">Reminer</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="p">........</span></pre></td><td><p>.</p></td><td><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="n">P1</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">Reminder</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">Reminder</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">Reminder</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span><span class="p">........</span></pre></td><td><p>.</p></td></tr></tbody></table><table cellpadding="0" cellspacing="0" class="smallerelementwithfullborder"><thead><tr><th><p>time</p></th><th><p>p0</p></th><th><p>p1</p></th><th><p>p2</p></th><th><p>p3</p></th></tr></thead><tbody><tr><td><p>0</p></td><td><p>p0_rs0</p></td><td><p>p1_rs0</p></td><td rowspan="2"><p>p2_rs0</p></td><td rowspan="3"><p>p3_rs0</p></td></tr><tr><td><p>1</p></td><td><p>cs1</p></td><td><p>cs1</p></td></tr><tr><td><p>2</p></td><td rowspan="2"><p>p0_rs1</p></td><td><p>p1_rs1</p></td><td><p>cs3</p></td></tr><tr><td><p>3</p></td><td><p>cs1</p></td><td rowspan="2"><p>p2_rs1</p></td><td rowspan="2"><p>cs1</p></td></tr><tr><td><p>4</p></td><td rowspan="3"><p>cs2</p></td><td rowspan="2"><p>p1_rs2</p></td></tr><tr><td><p>5</p></td><td><p>cs1</p></td><td rowspan="2"><p>p3_rs1</p></td></tr><tr><td><p>6</p></td><td><p>cs1</p></td><td rowspan="2"><p>cs2</p></td></tr><tr><td><p>7</p></td><td rowspan="2"><p>p0_rs2</p></td><td rowspan="3"><p>cs2</p></td><td><p>cs3</p></td></tr><tr><td><p>8</p></td><td rowspan="2"><p>cs1</p></td><td rowspan="2"><p>cs2</p></td></tr><tr><td><p>9</p></td><td><p>cs1</p></td></tr><tr><td><p>....</p></td><td><p>....</p></td><td><p>....</p></td><td><p>....</p></td><td><p>....</p></td></tr></tbody></table></div><div class="step step-level-1 t2c" step="7" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="simplify">Simplify</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="n">P0</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">P0_rs0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">P0_rs1</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS2</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="n">CS2</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS2</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="n">P0_rs3</span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span><span class="n">CS1</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">20 </span><span class="w">
</span><span class="ln">21 </span><span class="w"></span><span class="p">........</span></pre></td><td><p>.</p></td><td><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="n">P1</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">P1_rs0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">P1_rs1</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="n">CS2</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="n">P0_rs2</span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span><span class="n">CS1</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS1</span><span class="w">
</span><span class="ln">20 </span><span class="w">
</span><span class="ln">21 </span><span class="w"></span><span class="n">Entry</span><span class="w"> </span><span class="n">CS2</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="n">CS2</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span><span class="n">Exit</span><span class="w"> </span><span class="n">CS2</span><span class="w">
</span><span class="ln">24 </span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="p">........</span></pre></td><td><p>.</p></td></tr></tbody></table><div class="substep"><ol><li class="substep">Just for two processes</li><li class="substep">Just one critical section in code</li></ol><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="n">Entry</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w">  </span><span class="n">Critical</span><span class="w"> </span><span class="n">Section</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="n">Exit</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="n">Reminder</span><span class="w"> </span><span class="n">Section</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div></div><div class="step step-level-1" step="8" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="requirements-for-software-based-solution">Requirements for Software Based Solution</h1><ol><li class="substep">compilers do not put shared variables in registers</li><li class="substep"><dl><dt>MMU of Cpu does not cache the shared section (page)</dt><dd><ul><li class="substep">How does it know?</li><li class="substep"><img src="img/memory_paging_typical_page_table_entry.jpg" width="450px" class="substep" align="center"></li></ul></dd></dl></li><li class="substep">Memory restriction (one request, no parallel respond)</li></ol></div><div class="step step-level-1" step="9" id="first-try-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="using-one-shared-variable">Using one Shared Variable</h1><p class="substep">Share code</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><p class="substep"><span class="math ">\(P_0\)</span></p><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 3 </span><span class="c1"></span><span class="w">    </span><span class="p">{</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">          </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w">          </span><span class="c1">// Critical Section
</span><span class="ln"> 7 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 8 </span><span class="w">          </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="c1">// Reminder Section
</span><span class="ln">12 </span><span class="c1"></span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><p class="substep"><span class="math ">\(P_1\)</span></p><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 3 </span><span class="c1"></span><span class="w">    </span><span class="p">{</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">          </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w">          </span><span class="c1">// Critical Section
</span><span class="ln"> 7 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 8 </span><span class="w">          </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="c1">// Reminder Section
</span><span class="ln">12 </span><span class="c1"></span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div><div class="step step-level-1" step="10" id="second-try-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="using-one-shared-variable-busy">Using one Shared Variable(busy)</h1><p class="substep">Share code</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><p class="substep"><span class="math ">\(P_0\)</span></p><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 3 </span><span class="c1"></span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 5 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 6 </span><span class="w">  </span><span class="c1">// Critical Section
</span><span class="ln"> 7 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="c1">// Reminder Section
</span><span class="ln">11 </span><span class="c1"></span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="p">}</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><p class="substep"><span class="math ">\(P_1\)</span></p><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 3 </span><span class="c1"></span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln"> 5 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 6 </span><span class="w">  </span><span class="c1">// Critical Section
</span><span class="ln"> 7 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="c1">// Reminder Section
</span><span class="ln">11 </span><span class="c1"></span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="p">}</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div><div class="step step-level-1" step="11" id="second-try-run-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="mutual-exclusion-violation">Mutual Exclusion Violation</h1><p class="substep">Share code</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><p class="substep"><span class="math ">\(P_0\)</span></p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln">4 </span><span class="c1"></span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">//Critical Section: CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit</span></pre><p class="substep"><span class="math ">\(P_1\)</span></p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Entry
</span><span class="ln">4 </span><span class="c1"></span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">//Critical Section: CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit</span></pre></div><div class="step step-level-1" step="12" id="second-try-trace-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="trace-second-try">Trace Second Try</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// P0
</span><span class="ln">2 </span><span class="c1"></span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// Critical Section : CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// P1
</span><span class="ln">2 </span><span class="c1"></span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// Critical Section : CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">busy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1</li><li class="substep"><span class="math ">\(P_0\)</span> 3</li><li class="substep"><span class="math ">\(P_0\)</span> 5</li><li class="substep"><span class="math ">\(P_1\)</span> 1</li><li class="substep"><span class="math ">\(P_1\)</span> 1</li><li class="substep"><span class="math ">\(P_0\)</span> 7</li><li class="substep"><span class="math ">\(P_1\)</span> 3</li><li class="substep"><span class="math ">\(P_1\)</span> 5</li></ol><ol class="trace-code"><li class="substep"><span class="math ">\(P_0\)</span> 1</li><li class="substep"><span class="math ">\(P_1\)</span> 1</li><li class="substep"><span class="math ">\(P_0\)</span> 3</li><li class="substep"><span class="math ">\(P_1\)</span> 3</li><li class="substep"><em>Mutual Exclusion Violation</em></li></ol></div><div class="step step-level-1" step="13" id="third-try-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="sharing-turn">Sharing turn</h1><p class="substep">Share code</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><p class="substep"><span class="math ">\(P_0\)</span></p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">5 </span><span class="c1"></span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span></pre><p class="substep"><span class="math ">\(P_1\)</span></p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">5 </span><span class="c1"></span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span></pre><p class="substep">Problem ?</p></div><div class="step step-level-1" step="14" id="software-cs-turn-i-j-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="turn-i-j">turn i j</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Share code
</span><span class="ln">2 </span><span class="c1"></span><span class="kt">int</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// P0
</span><span class="ln">2 </span><span class="c1"></span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// P1
</span><span class="ln">2 </span><span class="c1"></span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Share code
</span><span class="ln">2 </span><span class="c1"></span><span class="kt">int</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Pi
</span><span class="ln">2 </span><span class="c1"></span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Pj
</span><span class="ln">2 </span><span class="c1"></span><span class="k">while</span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">;</span></pre></div><div class="step step-level-1" step="15" id="software-cs-need-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="need-cs">need CS</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Share Code
</span><span class="ln">2 </span><span class="c1"></span><span class="kt">bool</span><span class="w"> </span><span class="n">need</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Pi
</span><span class="ln">2 </span><span class="c1"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">7 </span><span class="c1"></span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Pj
</span><span class="ln">2 </span><span class="c1"></span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">7 </span><span class="c1"></span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><p class="substep">Problem ?</p><ol class="trace-code"><li class="substep"><span class="math ">\(P_i\)</span> 2</li><li class="substep"><span class="math ">\(P_j\)</span> 2</li><li class="substep"><span class="math ">\(P_i\)</span> 3</li><li class="substep"><span class="math ">\(P_j\)</span> 3</li><li class="substep">&#8734;</li></ol></div><div class="step step-level-1" step="16" id="software-cs2processes-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="software-soloution-2-processes">Software Soloution 2 processes</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Share Code
</span><span class="ln">2 </span><span class="c1"></span><span class="kt">bool</span><span class="w"> </span><span class="n">need</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="c1">// Pi
</span><span class="ln"> 2 </span><span class="c1"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="c1">// Pj
</span><span class="ln"> 2 </span><span class="c1"></span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="c1">// Pi
</span><span class="ln"> 2 </span><span class="c1"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span><span class="n">b3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b2</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="n">b3</span><span class="p">)</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="p">;</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">11 </span><span class="c1"></span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">;</span></pre></div><div class="step step-level-1" step="17" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><ul><li><a href="https://en.wikipedia.org/wiki/Mutual_exclusion">https://en.wikipedia.org/wiki/Mutual_exclusion</a></li><li><a href="https://en.wikipedia.org/wiki/Dekker%27s_algorithm">https://en.wikipedia.org/wiki/Dekker%27s_algorithm</a></li><li><a href="https://en.wikipedia.org/wiki/Peterson%27s_algorithm">https://en.wikipedia.org/wiki/Peterson%27s_algorithm</a></li><li><a href="https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm">https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm</a></li><li>operating system process synchronization history dekker peterson</li></ul></div><div class="step step-level-1" step="18" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="python-code">Python Code</h1><pre class="highlight code python"><span class="ln">1 </span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">need</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">P_i</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="n">j</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>    <span class="k">while</span> <span class="n">sh1</span><span class="o">.</span><span class="n">need</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">sh1</span><span class="o">.</span><span class="n">turn</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>      <span class="k">pass</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Critical Section"</span><span class="p">)</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">need</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Reminder Section"</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="n">sh1</span> <span class="o">=</span> <span class="n">MyShare</span><span class="p">()</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span><span class="n">th1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">P_0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,))</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span><span class="n">th2</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">P_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,));</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="n">th1</span><span class="o">.</span><span class="n">start</span><span class="p">();</span><span class="n">th2</span><span class="o">.</span><span class="n">start</span><span class="p">();</span></pre></div><div class="step step-level-1 t2c" step="19" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-i">Software Soloution n processes(I)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Each process
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="ln">4 </span><span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln">6 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln">7 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 2: Before assignment</li><li class="substep"><span class="math ">\(P_2\)</span> 2: Get the same number as P1</li><li class="substep"><span class="math ">\(P_2\)</span> 3, 4, 5, 6: in critical section</li><li class="substep"><span class="math ">\(P_1\)</span> 2: assign the number</li><li class="substep"><span class="math ">\(P_1\)</span> 3: given P2 is the only process</li><li class="substep"><span class="math ">\(P_1\)</span> 4: Number[1] == number[2]</li><li class="substep"><span class="math ">\(P_1\)</span> 5: then break</li><li class="substep"><span class="math ">\(P_1\)</span> 6: in cs then mutual exclusion violation</li></ol></div><div class="step step-level-1 t2c" step="20" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-ii">Software Soloution n processes(II)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Each process
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="ln">4 </span><span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln">6 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln">7 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><ol class="trace-code"><li class="substep"><span class="math ">\(P_1\)</span> 2: Before assignment</li><li class="substep"><span class="math ">\(P_2\)</span> 2: Get the same number as P1</li><li class="substep"><span class="math ">\(P_1\)</span> 2: After assignment</li><li class="substep"><span class="math ">\(P_1\)</span> 3: Only for P2 with the same number</li><li class="substep"><span class="math ">\(P_1\)</span> 4: number[1] &gt;= number[2] then wait</li><li class="substep"><span class="math ">\(P_2\)</span> 3: Only for P1 with the same number</li><li class="substep"><span class="math ">\(P_2\)</span> 4: number[2] &gt;= number[1] then wait</li><li class="substep">Unlimited wait or <em>Dead Lock</em>  &#8734;</li></ol></div><div class="step step-level-1 t2c" step="21" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-iii">Software Soloution n processes(III)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Each process
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="ln">4 </span><span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w">
</span><span class="ln">5 </span><span class="w">       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w">
</span><span class="ln">6 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln">8 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span></pre><ol class="trace-code"><li class="substep">Test</li></ol></div><div class="step step-level-1" step="22" id="software-cs-n-processes-ii-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-iii-1">Software Soloution n processes(III)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Each process
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">!=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">){</span><span class="w">
</span><span class="ln">4 </span><span class="w">   </span><span class="k">while</span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w">
</span><span class="ln">5 </span><span class="w">         </span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln">6 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln">8 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre></div><div class="step step-level-1 t2c" step="23" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-iii-2">Software Soloution n processes(III)</h1><div><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w"> </span><span class="c1">// P0
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span><span class="n">j</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">   </span><span class="k">while</span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">         </span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mi">0</span><span class="o">&lt;</span><span class="n">j</span><span class="p">))</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w"> </span><span class="c1">// P1
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">!=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">   </span><span class="k">while</span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">         </span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mi">1</span><span class="o">&lt;</span><span class="n">j</span><span class="p">))</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre></div><ol class="trace-code"><li class="substep">P0-2 (number[0]== 0)</li><li class="substep">P1-2 (number[1]== 0)</li><li class="substep">P0-3 (number[0]== 1)</li><li class="substep">P0-4,5(all other number[j]==0)</li><li class="substep">P0-6,7</li><li class="substep">P0-8 (critical section)</li><li class="substep">P1-3 (number[1] == 1)</li><li class="substep">P1-4, 5</li><li class="substep">P1-6 ( i &lt; j  , 1 &lt; 0 ? )</li><li class="substep">P1-7,8 (in critical section)</li><li class="substep"><strong>Mutual exclusion violation</strong></li></ol></div><div class="step step-level-1" step="24" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="38400" data-y="0" data-z="0"><h1 id="software-soloution-n-processes-iii-3">Software Soloution n processes(III)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w">
</span><span class="ln">2 </span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">choose</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w"> </span><span class="n">choose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"> </span><span class="n">choose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="n">choose</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">   </span><span class="k">while</span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">         </span><span class="p">((</span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">       </span><span class="p">;</span><span class="w">
</span><span class="ln">10 </span><span class="w"> </span><span class="cm">/* Critical Section */</span><span class="w">
</span><span class="ln">11 </span><span class="w">
</span><span class="ln">12 </span><span class="w"> </span><span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><ul><li><a href="https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm">https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm</a></li></ul></div><div class="step step-level-1" step="25" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="40000" data-y="0" data-z="0"><h1 id="hardware-soloution-i">Hardware Soloution(I)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="nf">testAndSet</span><span class="p">(</span><span class="kt">bool</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lock</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">  </span><span class="c1">// Share section
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">lock</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">  </span><span class="c1">// Each process
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">testAndSet</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w">
</span><span class="ln">3 </span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="c1">//    CRITICAL SECTION
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="n">lock</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span></pre></div><div class="step step-level-1" step="26" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="41600" data-y="0" data-z="0"><h1 id="assembly-implementation">Assembly implementation</h1><pre class="highlight code asm"><span class="ln"> 1 </span><span class="nl">Start_Share_region:</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="nf">move</span><span class="w"> </span><span class="no">lock</span><span class="p">,</span><span class="w"> </span><span class="mi">#0</span><span class="w">      </span><span class="c1">; store 0 in flag
</span><span class="ln"> 3 </span><span class="c1"></span><span class="w">  </span><span class="nf">ret</span><span class="w">                </span><span class="c1">; return to caller
</span><span class="ln"> 4 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="nl">enter_region:</span><span class="w">        </span><span class="c1">; entry point.
</span><span class="ln"> 6 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="nf">move</span><span class="w"> </span><span class="no">reg</span><span class="p">,</span><span class="w"> </span><span class="mi">#1</span><span class="w">       </span><span class="c1">; Was flag zero on entry_region?
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="nl">loop:</span><span class="w">                </span><span class="c1">; A "jump to" tag
</span><span class="ln">10 </span><span class="c1"></span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="nf">tsl</span><span class="w"> </span><span class="no">reg</span><span class="p">,</span><span class="w"> </span><span class="no">lock</span><span class="w">      </span><span class="c1">; Test and Set Lock; flag is the shared variable; it is copied
</span><span class="ln">12 </span><span class="c1"></span><span class="w">                     </span><span class="c1">; into the register reg and flag then atomically set to 1.
</span><span class="ln">13 </span><span class="c1"></span><span class="w">
</span><span class="ln">14 </span><span class="w">  </span><span class="nf">cmp</span><span class="w"> </span><span class="no">reg</span><span class="p">,</span><span class="w"> </span><span class="mi">#0</span><span class="w">        </span><span class="c1">; Was flag zero on entry_region?
</span><span class="ln">15 </span><span class="c1"></span><span class="w">
</span><span class="ln">16 </span><span class="w">  </span><span class="nf">jnz</span><span class="w"> </span><span class="no">loop</span><span class="w">           </span><span class="c1">; Jump to enter_region if reg is non-zero; i.e.,
</span><span class="ln">17 </span><span class="c1"></span><span class="w">                     </span><span class="c1">; flag was non-zero on entry.
</span><span class="ln">18 </span><span class="c1"></span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="nf">ret</span><span class="w">                </span><span class="c1">; Exit; i.e., flag was zero on entry. If we get here, tsl
</span><span class="ln">20 </span><span class="c1"></span><span class="w">                     </span><span class="c1">; will have set it non-zero; thus, we have claimed the resource associated with flag.
</span><span class="ln">21 </span><span class="c1"></span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="nl">exit_region:</span><span class="w">
</span><span class="ln">23 </span><span class="w">  </span><span class="nf">move</span><span class="w"> </span><span class="no">lock</span><span class="p">,</span><span class="w"> </span><span class="mi">#0</span><span class="w">      </span><span class="c1">; store 0 in flag
</span><span class="ln">24 </span><span class="c1"></span><span class="w">  </span><span class="nf">ret</span><span class="w">                </span><span class="c1">; return to caller</span></pre></div><div class="step step-level-1" step="27" id="hardware-cs-i-trace-id" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="43200" data-y="0" data-z="0"><pre class="highlight code cpp"><span class="ln">1 </span><span class="w">  </span><span class="c1">// P0
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">TS</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w">
</span><span class="ln">4 </span><span class="w">      </span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="c1">// RS
</span><span class="ln">8 </span><span class="c1"></span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w">  </span><span class="c1">// P1
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">TS</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w">
</span><span class="ln">4 </span><span class="w">      </span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="c1">// RS
</span><span class="ln">8 </span><span class="c1"></span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><pre class="highlight code cpp"><span class="ln">1 </span><span class="w">  </span><span class="c1">// P2
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">TS</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w">
</span><span class="ln">4 </span><span class="w">      </span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="c1">// RS
</span><span class="ln">8 </span><span class="c1"></span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><ol class="trace-code"><li class="substep">P0-3 , P1-3 , P2-3</li><li class="substep">P0-3 , P1-5 , P2-3</li><li class="substep">P0-3 , P1-6 , P2-3</li><li class="substep">P0-3 , P1-7 , P2-5</li><li class="substep">P0-3 , P1-3 , P2-6</li><li class="substep">P0-3 , P1-5 , P2-7</li><li class="substep">P0-3 , P1-6 , P2-3</li><li class="substep">P0-3 , P1-7 , P2-5</li><li class="substep">P0-3 , P1-3 , P2-6</li><li class="substep">P0-3 , P1-5 , P2-7</li><li class="substep">P0-3 , P1-6 , P2-3</li><li class="substep">.... , ....  , ....</li><li class="substep"><strong>P0 : starve</strong></li></ol></div><div class="step step-level-1" step="28" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="44800" data-y="0" data-z="0"><h1 id="hardware-soloution-ii">Hardware Soloution(II)</h1><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// Share section
</span><span class="ln"> 2 </span><span class="c1"></span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="kt">bool</span><span class="w"> </span><span class="n">waiting</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span><span class="kt">bool</span><span class="w"> </span><span class="n">lock</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span><span class="c1">// Each Process
</span><span class="ln"> 7 </span><span class="c1"></span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">waiting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">key</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">waiting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testAndSet</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w">  </span><span class="n">waiting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="c1">// CRITICAL SECTION
</span><span class="ln">16 </span><span class="c1"></span><span class="w">
</span><span class="ln">17 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">;</span><span class="w">
</span><span class="ln">18 </span><span class="w">  </span><span class="k">while</span><span class="p">((</span><span class="n">j</span><span class="o">!=</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">waiting</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w">
</span><span class="ln">19 </span><span class="w">     </span><span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">;</span><span class="w">
</span><span class="ln">20 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">i</span><span class="p">)</span><span class="w">  </span><span class="n">lock</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="k">else</span><span class="w">      </span><span class="n">waiting</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">22 </span><span class="w">
</span><span class="ln">23 </span><span class="w">  </span><span class="c1">// REMINDER SECTION
</span><span class="ln">24 </span><span class="c1"></span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre><p class="substep">busy waiting</p></div><div class="step step-level-1" step="29" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="46400" data-y="0" data-z="0"><h1 id="can-we-use-queue">Can We Use Queue?</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">Queue</span><span class="p">[</span><span class="n">max</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="kt">bool</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="kt">bool</span><span class="w"> </span><span class="n">busyQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">testAndset</span><span class="p">(</span><span class="n">busyQueue</span><span class="p">));</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="n">Queue</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">process_number</span><span class="p">);</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="n">busyQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">Queue</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">process_number</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="c1">// or &amp;&amp;
</span><span class="ln"> 6 </span><span class="c1"></span><span class="w">    </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testAndSet</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="c1">//cs
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">testAndset</span><span class="p">(</span><span class="n">busyQueue</span><span class="p">));</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="n">Queue</span><span class="p">.</span><span class="n">remove</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="n">busyQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">12 </span><span class="w">  </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">  </span><span class="c1">//rs</span></pre><p class="substep"><strong>Wrong Answer</strong></p></div><div class="step step-level-1" step="30" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="48000" data-y="0" data-z="0"><h1 id="hardware-soloution-iii">Hardware Soloution(III)</h1><h2 id="swap">Swap</h2><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">booelan</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">boolean</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">    </span><span class="n">boolean</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">bool</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="n">swap</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="c1">// CS
</span><span class="ln">6 </span><span class="c1"></span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span></pre><p class="substep">processor xchg instructions</p><p class="substep"><a href="http://qcd.phys.cmu.edu/QCDcluster/intel/vtune/reference/6400380.htm">http://qcd.phys.cmu.edu/QCDcluster/intel/vtune/reference/6400380.htm</a></p><p class="substep">The memory read and write are guaranteed to be atomic.</p><p class="substep"><a href="https://developer.arm.com/documentation/dht0008/a/swp-and-swpb/legacy-synchronization-instructions/swp-and-swpb">ARM  SWP</a></p></div><div class="step step-level-1" step="31" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="49600" data-y="0" data-z="0"><h1 id="disable-enable-interrupt">Disable / Enable Interrupt</h1><h2 id="why-don-t-they-use-this-feature-of-interrupt">Why don't they use this feature of interrupt?</h2><pre class="highlight code cpp"><span class="n">DisableInterrupt</span><span class="p">()</span><span class="w">

</span><span class="c1">// CS
</span><span class="w">
</span><span class="n">EnableInterrupt</span><span class="p">()</span></pre></div><div class="step step-level-1" step="32" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="51200" data-y="0" data-z="0"><h1 id="requirements-for-solution">Requirements for Solution</h1><ul><li class="substep">Mutual exclusion</li><li class="substep">Progress</li><li class="substep">Bounded waiting</li></ul></div><div class="step step-level-1 t2c" step="33" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="52800" data-y="0" data-z="0"><h1 id="semaphore-i">Semaphore(I)</h1><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">Semaphore</span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">Semaphore</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">){</span><span class="n">s</span><span class="o">=</span><span class="n">n</span><span class="p">;}</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">      </span><span class="k">while</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">        </span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">      </span><span class="n">s</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">V</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">      </span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">14 </span><span class="w">  </span><span class="p">}</span></pre><div><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">  </span><span class="c1">// Shared section
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="n">Semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="w">  </span><span class="c1">// Each process use the following structure for CS
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">        </span><span class="c1">// CS
</span><span class="ln"> 6 </span><span class="c1"></span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">        </span><span class="c1">// RS
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="p">}</span></pre></div></div><div class="step step-level-1 t2c" step="34" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="54400" data-y="0" data-z="0"><h1 id="semaphore-ii-no-busy-waiting">Semaphore(II - no busy waiting)</h1><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">semaphore</span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"> </span><span class="n">myIntQueue</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">P</span><span class="p">(){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">      </span><span class="n">s</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">getMyProcessPID</span><span class="p">());</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">        </span><span class="n">blockMe</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">      </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">      </span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln">14 </span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">del</span><span class="p">();</span><span class="w">
</span><span class="ln">15 </span><span class="w">        </span><span class="n">wakeupProcess</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">16 </span><span class="w">      </span><span class="p">}</span><span class="w">
</span><span class="ln">17 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="n">semaphore</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">){</span><span class="n">s</span><span class="o">=</span><span class="n">i</span><span class="p">;}</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="p">};</span></pre><div><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">  </span><span class="c1">// Shared section
</span><span class="ln">2 </span><span class="c1"></span><span class="w">  </span><span class="n">Semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">    </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">        </span><span class="c1">// CS
</span><span class="ln">5 </span><span class="c1"></span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">        </span><span class="c1">// RS
</span><span class="ln">7 </span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w">  </span><span class="p">}</span></pre></div></div><div class="step step-level-1 t2c" step="35" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="56000" data-y="0" data-z="0"><h1 id="sempahore-iii-extra-functions">Sempahore(III) extra functions</h1><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">testAndSet</span><span class="p">(</span><span class="kt">bool</span><span class="o">&amp;</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="p">{</span><span class="kt">bool</span><span class="w"> </span><span class="n">rv</span><span class="o">=</span><span class="n">target</span><span class="p">;</span><span class="n">target</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;}</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">myIntQueue</span><span class="p">{</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferOfQueue</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">;</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">myIntQueue</span><span class="p">(){</span><span class="n">first</span><span class="o">=</span><span class="n">last</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">10 </span><span class="w">      </span><span class="n">bufferOfQueue</span><span class="p">[</span><span class="n">last</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln">11 </span><span class="w">      </span><span class="n">last</span><span class="o">=</span><span class="p">(</span><span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">MAX</span><span class="p">;</span><span class="w">
</span><span class="ln">12 </span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">del</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">15 </span><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferOfQueue</span><span class="p">[</span><span class="n">first</span><span class="p">];</span><span class="w">
</span><span class="ln">16 </span><span class="w">      </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">MAX</span><span class="p">;</span><span class="w">
</span><span class="ln">17 </span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="p">};</span><span class="w">
</span><span class="ln">20 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">wakeupProcess</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">blockMe</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w">
</span><span class="ln">22 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">getMyProcessPID</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">semaphore</span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">myIntQueue</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">      </span><span class="k">while</span><span class="p">(</span><span class="n">testAndSet</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">      </span><span class="n">s</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln">10 </span><span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">getMyProcessPID</span><span class="p">());</span><span class="w">
</span><span class="ln">11 </span><span class="w">        </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">12 </span><span class="w">        </span><span class="n">blockMe</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">      </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">16 </span><span class="w">      </span><span class="k">while</span><span class="p">(</span><span class="n">testAndSet</span><span class="p">(</span><span class="n">lock</span><span class="p">))</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">17 </span><span class="w">      </span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">18 </span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">19 </span><span class="w">        </span><span class="n">wakeupProcess</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">del</span><span class="p">());</span><span class="w">
</span><span class="ln">20 </span><span class="w">      </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="n">semaphore</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="ln">23 </span><span class="w">    </span><span class="p">{</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;}</span><span class="w">
</span><span class="ln">24 </span><span class="w">  </span><span class="p">};</span></pre></div><div class="step step-level-1 t2c" step="36" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="57600" data-y="0" data-z="0"><h1 id="semaphore-iv-simple-usage">Semaphore(IV) Simple Usage</h1><div><pre class="highlight code cpp"><span class="ln">1 </span><span class="c1">// shared section
</span><span class="ln">2 </span><span class="c1"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// Pi
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="c1">//   Critical Section
</span><span class="ln"> 6 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="c1">//   Reminder Section</span></pre></div><div><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">sem_printer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sem_scanner</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// Pi
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="c1">// work with printer
</span><span class="ln"> 6 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="p">....</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">sem_scanner</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">12 </span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="c1">// Work with scanner
</span><span class="ln">14 </span><span class="c1"></span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="n">sem_sanner</span><span class="p">.</span><span class="n">V</span><span class="p">();</span></pre></div></div><div class="step step-level-1 t2c" step="37" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="59200" data-y="0" data-z="0"><h1 id="another-forms-of-semaphore">Another Forms of Semaphore</h1><div><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// Each process
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="c1">// Critical Section
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">V</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="c1">// Reminder Section
</span><span class="ln">13 </span><span class="c1"></span><span class="w">
</span><span class="ln">14 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span><span class="p">}</span></pre></div><div><pre class="highlight code cpp"><span class="ln">1 </span><span class="w">  </span><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="w"> </span><span class="c1">// Each process
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w">     </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">
</span><span class="ln"> 8 </span><span class="w">     </span><span class="c1">// Critical Section
</span><span class="ln"> 9 </span><span class="c1"></span><span class="w">
</span><span class="ln">10 </span><span class="w">     </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w">
</span><span class="ln">12 </span><span class="w">     </span><span class="c1">// Reminder Section
</span><span class="ln">13 </span><span class="c1"></span><span class="w">
</span><span class="ln">14 </span><span class="w">   </span><span class="p">}</span><span class="w">
</span><span class="ln">15 </span><span class="w"> </span><span class="p">}</span></pre></div></div><div class="step step-level-1" step="38" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="60800" data-y="0" data-z="0"><h1 id="other-types-of-semaphore">Other Types of Semaphore</h1><ol><li>Binary Semaphore</li><li>Weak Semaphore</li><li>Priority Semaphore</li></ol><h2 id="c-semaphore">C++ Semaphore</h2><ul><li><a href="https://en.cppreference.com/w/cpp/thread/counting_semaphore">https://en.cppreference.com/w/cpp/thread/counting_semaphore</a></li></ul><ol><li>std::counting_semaphore</li><li>std::binary_semaphore</li></ol><h2 id="posix">POSIX</h2><ul><li><a href="https://ebrary.net/51306/computer_science/burst_fifo_mode_semaphores">https://ebrary.net/51306/computer_science/burst_fifo_mode_semaphores</a></li><li><a href="https://cwiki.apache.org/confluence/display/NUTTX/Signaling+Semaphores+and+Priority+Inheritance">https://cwiki.apache.org/confluence/display/NUTTX/Signaling+Semaphores+and+Priority+Inheritance</a></li></ul></div><div class="step step-level-1 t2c" step="39" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="62400" data-y="0" data-z="0"><h1 id="simple-deadlock">Simple Deadlock</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">sem_printer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sem_scanner</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><p>.</p><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// P0
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">sem_scanner</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="c1">// work with printer
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">sem_scanner</span><span class="p">.</span><span class="n">V</span><span class="p">();</span></pre><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="c1">// P1
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">sem_scanner</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="c1">// Work with scanner
</span><span class="ln"> 8 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="n">sem_sanner</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="n">sem_printer</span><span class="p">.</span><span class="n">V</span><span class="p">();</span></pre></div><div class="step step-level-1 t2c" step="40" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="64000" data-y="0" data-z="0"><h1 id="python-semaphore">Python Semaphore</h1><pre class="highlight code python"><span class="ln">1 </span><span class="o">//</span> <span class="n">Share</span> <span class="n">part</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">999999</span><span class="p">:</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P(); full.wait();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># full.V(); full.signal();</span></pre><p>src/semaphore10.py</p><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">sh1</span> <span class="o">=</span> <span class="n">MyShare</span><span class="p">()</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">th1</span><span class="o">=</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,))</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="n">th2</span><span class="o">=</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,))</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>  <span class="n">th1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>  <span class="n">th2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>  <span class="n">th1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>  <span class="n">th2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>  <span class="nb">print</span><span class="p">(</span><span class="s2">"counter "</span><span class="p">,</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span><span class="p">)</span></pre></div><div class="step step-level-1" step="41" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="65600" data-y="0" data-z="0"><h1 id="producer-consumer-i">Producer consumer(I)</h1><img src="img/bounded-buffer-problem.webp"></div><div class="step step-level-1" step="42" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="67200" data-y="0" data-z="0"><h1 id="producer-consumer-ii">Producer consumer(II)</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">produce</span><span class="p">():</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>  <span class="nb">print</span><span class="p">(</span><span class="s1">'produce '</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">100</span><span class="p">)</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>  <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">100</span><span class="w">
</span><span class="ln">10 </span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="n">x</span><span class="p">):</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="nb">print</span><span class="p">(</span><span class="s1">'consume '</span><span class="p">,</span><span class="n">x</span><span class="p">)</span></pre></td><td><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">sh1</span> <span class="o">=</span> <span class="n">MyShare</span><span class="p">()</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">th1</span><span class="o">=</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,))</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="n">th2</span><span class="o">=</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sh1</span><span class="p">,))</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>  <span class="n">th1</span><span class="o">.</span><span class="n">start</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>  <span class="n">th2</span><span class="o">.</span><span class="n">start</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>  <span class="n">th1</span><span class="o">.</span><span class="n">join</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>  <span class="n">th2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="nb">print</span><span class="p">(</span><span class="s2">"counter "</span><span class="p">,</span> <span class="n">sh1</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span></pre></td></tr><tr><td><pre class="highlight code python"><span class="ln">1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span></pre></td><td><pre class="highlight code python"><span class="ln">1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></pre></td></tr></tbody></table></div><div class="step step-level-1 t2c" step="43" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="68800" data-y="0" data-z="0"><h1 id="unbounded-buffer-wrong-answer">Unbounded Buffer(Wrong Answer)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="n">mutex</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre><p>.</p><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># empty.V()</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="mi">1</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></pre></div><div class="step step-level-1 t2c" step="44" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="70400" data-y="0" data-z="0"><h1 id="unbounded-buffer-ii">Unbounded Buffer(II)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre><p>.</p><pre class="highlight code python"><span class="ln">1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1"># full.V()</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="45" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="72000" data-y="0" data-z="0"><h1 id="unbounded-buffer-iii-better">Unbounded Buffer(III - better)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre><p>.</p><pre class="highlight code python"><span class="ln">1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1">### full.V()</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="46" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="73600" data-y="0" data-z="0"><h1 id="bounded-buffer-i">Bounded Buffer(I)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre><p>.</p><pre class="highlight code python"><span class="ln">1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1"># full.V()</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="p">(</span><span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.V()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="47" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="75200" data-y="0" data-z="0"><h1 id="bounded-buffer-ii">Bounded Buffer(II)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span></pre><pre class="highlight code python"><span class="ln">1 </span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">empty</span><span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="n">MyShare</span><span class="o">.</span><span class="n">n</span><span class="p">)</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># empty.P()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1"># empty.V()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="p">(</span><span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># empty.V()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="48" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="76800" data-y="0" data-z="0"><h1 id="bounded-buffer-any-kind-of-queue">Bounded Buffer(Any kind of Queue)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="n">Q</span> <span class="o">=</span> <span class="n">Any</span> <span class="n">kind</span> <span class="n">of</span> <span class="nb">complex</span> <span class="n">Queue</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="o">//</span> <span class="k">with</span> <span class="n">append</span> <span class="ow">and</span> <span class="n">delete</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="n">empty</span><span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w">
</span><span class="ln">7 </span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="n">mutex</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre><p>.</p><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">()</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># empty.P()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">Q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1"># empty.V()</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P()</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># empty.V()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="49" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="78400" data-y="0" data-z="0"><h1 id="producer-consumer-full">Producer consumer full</h1><pre class="highlight code python"><span class="ln">1 </span><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">time</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">z1</span><span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span><span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="n">z1</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">empty</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="nc">MyLog</span><span class="p">:</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">produce1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'(produce_'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">produce2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">')'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">"::"</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'(consume_'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">')'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">"::"</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">producer1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">'{producer-before'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">"::"</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">producer2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'Proudecer-'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'After'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">'}'</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">consumer1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'{Consumer--'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'before '</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">" "</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">" :: "</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="k">def</span><span class="w"> </span><span class="nf">consumer2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'Consumer--'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'After:'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'}'</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="w">
</span><span class="ln">32 </span><span class="w"></span><span class="n">lg</span><span class="o">=</span><span class="n">MyLog</span><span class="p">();</span><span class="w">
</span><span class="ln">33 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">produce</span><span class="p">(</span><span class="n">i</span><span class="p">):</span></pre><pre class="highlight code python"><span class="ln">33 </span>  <span class="kn">import</span><span class="w"> </span><span class="nn">random</span><span class="w">
</span><span class="ln">34 </span><span class="w"></span>  <span class="n">lg</span><span class="o">.</span><span class="n">producer1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">35 </span><span class="w"></span>  <span class="n">lg</span><span class="o">.</span><span class="n">produce1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">36 </span><span class="w"></span>  <span class="n">y</span><span class="o">=</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">100</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">N</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">37 </span><span class="w"></span>  <span class="n">lg</span><span class="o">.</span><span class="n">produce2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">38 </span><span class="w"></span>  <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="w">
</span><span class="ln">39 </span><span class="w"></span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span><span class="w">
</span><span class="ln">40 </span><span class="w"></span>  <span class="k">return</span> <span class="n">y</span><span class="p">;</span><span class="w">
</span><span class="ln">41 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">):</span><span class="w">
</span><span class="ln">42 </span><span class="w"></span>  <span class="kn">import</span><span class="w"> </span><span class="nn">random</span><span class="p">;</span><span class="w">
</span><span class="ln">43 </span><span class="w"></span>  <span class="n">lg</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">44 </span><span class="w"></span>  <span class="n">lg</span><span class="o">.</span><span class="n">consumer2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="ln">45 </span><span class="w"></span>  <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span><span class="w">
</span><span class="ln">46 </span><span class="w"></span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">());</span><span class="w">
</span><span class="ln">47 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">48 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">49 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9999999999999999</span><span class="p">):</span><span class="w">
</span><span class="ln">50 </span><span class="w"></span>    <span class="n">x</span><span class="o">=</span><span class="n">produce</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">51 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">acquire</span><span class="p">();</span>  <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>  <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span><span class="w">
</span><span class="ln">52 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="p">(</span><span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span> <span class="n">N</span><span class="p">;</span> <span class="n">lg</span><span class="o">.</span><span class="n">producer2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="ln">53 </span><span class="w"></span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln">54 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln">55 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">999999999999999</span><span class="p">):</span><span class="w">
</span><span class="ln">56 </span><span class="w"></span>    <span class="n">lg</span><span class="o">.</span><span class="n">consumer1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">57 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">();</span> <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="p">;</span> <span class="n">empty</span><span class="o">.</span><span class="n">release</span><span class="p">();</span><span class="w">
</span><span class="ln">58 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="p">;</span>  <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">59 </span><span class="w"></span><span class="n">myShare</span> <span class="o">=</span> <span class="n">MyShare</span><span class="p">()</span><span class="w">
</span><span class="ln">60 </span><span class="w"></span><span class="n">th1</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">myShare</span><span class="p">,))</span><span class="w">
</span><span class="ln">61 </span><span class="w"></span><span class="n">th2</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">myShare</span><span class="p">,))</span><span class="w">
</span><span class="ln">62 </span><span class="w"></span><span class="n">th1</span><span class="o">.</span><span class="n">start</span><span class="p">();</span><span class="n">th2</span><span class="o">.</span><span class="n">start</span><span class="p">();</span><span class="n">th1</span><span class="o">.</span><span class="n">join</span><span class="p">();</span><span class="n">th2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="w">
</span><span class="ln">63 </span><span class="w"></span><span class="nb">print</span><span class="p">(</span><span class="s1">'main --'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">" :: "</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="w">
</span><span class="ln">64 </span><span class="w"></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>  <span class="nb">print</span><span class="p">(</span><span class="n">myShare</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">end</span><span class="o">=</span><span class="s2">" :: "</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="w">
</span><span class="ln">65 </span><span class="w"></span><span class="nb">print</span><span class="p">(</span><span class="s2">"counter "</span><span class="p">,</span><span class="n">myShare</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="50" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="80000" data-y="0" data-z="0"><h1 id="bounded-buffer-percent-empty">Bounded Buffer(Percent Empty)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="k">class</span><span class="w"> </span><span class="nc">MyShare</span><span class="p">:</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span>  <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span>  <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span></pre><pre class="highlight code python"><span class="ln">1 </span><span class="n">full</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">2 </span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">empty</span><span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">MyShare</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">))</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">in1</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">produce</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">in1</span><span class="p">)</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># empty.P()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">in1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">release</span><span class="p">();</span> <span class="c1"># empty.V()</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">in1</span> <span class="o">=</span> <span class="p">(</span><span class="n">in1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span></pre><pre class="highlight code python"><span class="ln"> 1 </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">sh1</span><span class="p">):</span><span class="w">
</span><span class="ln"> 2 </span><span class="w"></span>  <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span>  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span>    <span class="n">full</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c1"># full.P()</span><span class="w">
</span><span class="ln"> 6 </span><span class="w"></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">sh1</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">];</span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span>    <span class="n">empty</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># empty.V()</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span>    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">sh1</span><span class="o">.</span><span class="n">n</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span>    <span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">out</span><span class="p">)</span></pre></div><div class="step step-level-1 t2c" step="51" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="81600" data-y="0" data-z="0"><h1 id="readers-and-writers-i">Readers and Writers(I)</h1><img src="img/readers.writers.png" width="70%"><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">()</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="p">{}</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">read</span><span class="p">()</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="p">{}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">write</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">RemainingTasks</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">read</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">RemainingTasks</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="52" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="83200" data-y="0" data-z="0"><h1 id="readers-and-writers-ii">Readers and Writers(II)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">wx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></pre><p>.</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">write</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">RemainingTasks</span><span class="p">();</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">read</span><span class="p">()</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">RemainingTasks</span><span class="p">();</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="53" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="84800" data-y="0" data-z="0"><h1 id="readers-and-writers-iii">Readers and Writers(III)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">wx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">read_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><p>.</p><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">write</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">wx</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">RemainingTasks</span><span class="p">();</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">read_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">      </span><span class="n">wx</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">read_count</span><span class="w"> </span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">read</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">read_count</span><span class="w"> </span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">read_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">        </span><span class="n">wx</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">RemainingWork</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="54" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="86400" data-y="0" data-z="0"><h1 id="readers-and-writers-iv">Readers and Writers(IV)</h1><div><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="n">semaphore</span><span class="w"> </span><span class="n">wrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">readCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">wrt</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="n">wirte</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">wrt</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="p">}</span></pre></div><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">readers</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="n">readCount</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">readCount</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">wrt</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="n">read</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="n">readCount</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">readCount</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">wrt</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">12 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1" step="55" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="88000" data-y="0" data-z="0"><h1 id="dininig-philosophers-i">Dininig Philosophers(I)</h1><img src="img/An_illustration_of_the_dining_philosophers_problem_small_wikipedia.png"></div><div class="step step-level-1 t2c" step="56" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="89600" data-y="0" data-z="0"><h1 id="dininig-philosophers-ii">Dininig Philosophers(II)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">//
</span><span class="ln">2 </span><span class="c1">// Shared Eating Objects
</span><span class="ln">3 </span><span class="c1">// Forks
</span><span class="ln">4 </span><span class="c1">// Food (Spagetti)
</span><span class="ln">5 </span><span class="c1">//</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">Rest</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="57" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="91200" data-y="0" data-z="0"><h1 id="dininig-philosophers-iii">Dininig Philosophers(III)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Shared Eating
</span><span class="ln">2 </span><span class="c1"></span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"thinking"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">eat</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">"Eating"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">forks</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="58" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="92800" data-y="0" data-z="0"><h1 id="dininig-philosophers-iv">Dininig Philosophers(IV)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Shared Eating
</span><span class="ln">2 </span><span class="c1"></span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">"Eating"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">eat</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"thinking"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">forks</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher0</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher0</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="59" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="94400" data-y="0" data-z="0"><h1 id="dininig-philosophers-iv-method-2">Dininig Philosophers(IV - method 2)</h1><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="c1">// Shared Eating
</span><span class="ln"> 2 </span><span class="c1"></span><span class="w">
</span><span class="ln"> 3 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">"Eating"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln"> 4 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">eat</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"thinking"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln"> 5 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">forks</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">
</span><span class="ln"> 7 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">13 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">      </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">      </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="k">else</span><span class="p">{</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">      </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">      </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="60" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="96000" data-y="0" data-z="0"><h1 id="dininig-philosophers-v-error-1">Dininig Philosophers(V - Error 1)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">]{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hungry</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="o">||</span><span class="w">
</span><span class="ln">4 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eating</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="c1">//thinking
</span><span class="ln">4 </span><span class="c1"></span><span class="w">    </span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// eating
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="61" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="97600" data-y="0" data-z="0"><h1 id="dininig-philosophers-error-2">Dininig Philosophers(Error 2)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">]{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hungry</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="o">||</span><span class="w">
</span><span class="ln">4 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">()</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eating</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="c1">//thinking
</span><span class="ln">4 </span><span class="c1"></span><span class="w">    </span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// eating
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="62" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="99200" data-y="0" data-z="0"><h1 id="dininig-philosophers-v">Dininig Philosophers(V)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">]{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hungry</span><span class="p">;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="o">||</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">()</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eating</span><span class="p">;</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="mi">-2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="mi">-1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">      </span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">  </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="c1">//thinking
</span><span class="ln">4 </span><span class="c1"></span><span class="w">    </span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// eating
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="63" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="100800" data-y="0" data-z="0"><h1 id="dininig-philosophers-vi">Dininig Philosophers(VI)</h1><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="c1">// Shared Eating
</span><span class="ln">2 </span><span class="c1"></span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">"Eating"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">eat</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"thinking"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;}</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">forks</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">numberOfPh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span></pre><pre class="highlight code cpp substep"><span class="ln"> 1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">    </span><span class="n">think</span><span class="p">();</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">numberOfPh</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">    </span><span class="n">eat</span><span class="p">();</span><span class="w">
</span><span class="ln"> 8 </span><span class="w">    </span><span class="n">forks</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">    </span><span class="n">forks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">numberOfPh</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">4 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="64" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="102400" data-y="0" data-z="0"><h1 id="monitor-i">Monitor(I)</h1><img src="img/simple.monitor.jpg"><pre class="highlight code cpp"><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
  </span><span class="c1">// Shared data
</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">

  </span><span class="c1">// Operations
</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f2</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f3</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">

  </span><span class="c1">// Initialization code
</span><span class="w">  </span><span class="c1">// Constructor
</span><span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m1</span><span class="o">:</span><span class="n">buffer</span><span class="p">)</span><span class="w">
    </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w">
</span><span class="p">};</span></pre></div><div class="step step-level-1 t2c" step="65" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="104000" data-y="0" data-z="0"><h1 id="monitor-ii">Monitor(II)</h1><pre class="highlight code python"><span class="ln">1 </span><span class="c1">#include&lt;iostream&gt;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="o">//</span> <span class="n">simple</span> <span class="n">monitor</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">struct</span> <span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">5 </span><span class="w"></span>  <span class="o">//</span> <span class="n">Shared</span> <span class="n">data</span><span class="w">
</span><span class="ln">6 </span><span class="w"></span>  <span class="n">static</span> <span class="n">const</span> <span class="nb">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w"></span>  <span class="nb">int</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span>  <span class="nb">int</span> <span class="n">count</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span>  <span class="w">
</span><span class="ln">10 </span><span class="w"></span>  <span class="o">//</span> <span class="n">Operations</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span>  <span class="n">void</span> <span class="n">f1</span><span class="p">(){</span><span class="o">/*....*/</span><span class="p">}</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span>  <span class="n">void</span> <span class="n">f2</span><span class="p">(){</span><span class="o">/*....*/</span><span class="p">}</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span>  <span class="n">void</span> <span class="n">f3</span><span class="p">(){</span><span class="o">/*....*/</span><span class="p">}</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span>  <span class="n">void</span> <span class="nb">print</span><span class="p">(){</span><span class="w">
</span><span class="ln">15 </span><span class="w"></span>    <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">m1</span> <span class="p">:</span> <span class="n">buffer</span><span class="p">)</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">m1</span> <span class="o">&lt;&lt;</span> <span class="s1">' '</span><span class="p">;</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span>  <span class="p">}</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  </pre><pre class="highlight code python"><span class="ln">18 </span>  <span class="o">//</span> <span class="n">initialization</span> <span class="n">code</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span>  <span class="n">mp</span><span class="p">(){</span><span class="w">
</span><span class="ln">20 </span><span class="w"></span>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w"></span>    <span class="k">for</span><span class="p">(</span><span class="nb">int</span><span class="o">&amp;</span> <span class="n">m1</span> <span class="p">:</span> <span class="n">buffer</span><span class="p">)</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span>      <span class="n">m1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span>  <span class="p">}</span><span class="w">
</span><span class="ln">24 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="nb">int</span> <span class="n">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span>  <span class="n">mp</span> <span class="n">mp1</span><span class="p">;</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span>  <span class="n">mp1</span><span class="o">.</span><span class="n">print</span><span class="p">();</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="66" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="105600" data-y="0" data-z="0"><h1 id="monitor-iii">Monitor(III)</h1><img src="img/monitor.png" width="70%"><pre class="highlight code cpp"><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
  </span><span class="c1">// Shared data
</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">

  </span><span class="c1">// Condition properties
</span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span><span class="w">

  </span><span class="c1">// Operations
</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f2</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kt">void</span><span class="w"> </span><span class="nf">f3</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="cm">/* .... */</span><span class="w"> </span><span class="p">}</span><span class="w">

  </span><span class="c1">// Initialization code
</span><span class="w">  </span><span class="c1">// Constructor
</span><span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m1</span><span class="o">:</span><span class="n">buffer</span><span class="p">)</span><span class="w">
    </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w">
</span><span class="p">};</span></pre></div><div class="step step-level-1 t2c" step="67" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="107200" data-y="0" data-z="0"><h1 id="monitor-iv-dininig-philosophers">Monitor(IV) Dininig Philosophers</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">3 </span><span class="w">    </span><span class="c1">//thinking
</span><span class="ln">4 </span><span class="c1"></span><span class="w">    </span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="c1">// eating
</span><span class="ln">6 </span><span class="c1"></span><span class="w">    </span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">16 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">17 </span><span class="w"></span><span class="p">}</span><span class="w"> </span></pre><pre class="highlight code cpp substep"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">dP</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="p">,</span><span class="w"> </span><span class="n">hungry</span><span class="p">,</span><span class="w"> </span><span class="n">eating</span><span class="p">}</span><span class="w">
</span><span class="ln">3 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="n">dP</span><span class="p">(){</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">9 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">13 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="c1">//thinking
</span><span class="ln">14 </span><span class="c1"></span><span class="w">    </span><span class="n">dP</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="c1">// eating
</span><span class="ln">16 </span><span class="c1"></span><span class="w">    </span><span class="n">dP</span><span class="p">.</span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">17 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">18 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="68" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="108800" data-y="0" data-z="0"><h1 id="monitor-v-dininig-philosophers">Monitor(V) Dininig Philosophers</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">dP</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="p">,</span><span class="n">hungry</span><span class="p">,</span><span class="n">eating</span><span class="p">}</span><span class="w">
</span><span class="ln">5 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">6 </span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">hungry</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="p">)</span><span class="o">||</span><span class="w">
</span><span class="ln">10 </span><span class="w">        </span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eating</span><span class="p">))</span><span class="w">
</span><span class="ln">11 </span><span class="w">      </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eating</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">14 </span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">16 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">17 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="o">!=</span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w">      </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">19 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="o">!=</span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln">20 </span><span class="w">      </span><span class="n">self</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">23 </span><span class="w">  </span><span class="n">dP</span><span class="p">(){</span><span class="w">
</span><span class="ln">24 </span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">25 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">26 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">29 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">30 </span><span class="w">    </span><span class="n">thinking</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">31 </span><span class="w">    </span><span class="n">eating</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">32 </span><span class="w"> </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">33 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">34 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">35 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="n">philosopher</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="ln">36 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">37 </span><span class="w">    </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">philosopher</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="ln">38 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">39 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="69" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="110400" data-y="0" data-z="0"><h1 id="monitor-vi-dininig-philosophers">Monitor(VI) Dininig Philosophers</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">chopstick</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="kt">bool</span><span class="w">  </span><span class="n">ach</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">};</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w">  </span><span class="n">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">count_m</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">count_m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> 
</span><span class="ln">12 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w">  
</span><span class="ln">14 </span><span class="w">      </span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">16 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> 
</span><span class="ln">17 </span><span class="w">      </span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">20 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">23 </span><span class="w">    </span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">24 </span><span class="w">    </span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">25 </span><span class="w">    </span><span class="n">count_m</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">26 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">count_m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  
</span><span class="ln">27 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">28 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">30 </span><span class="w">
</span><span class="ln">31 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">32 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">33 </span><span class="w">    </span><span class="n">thinking</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">34 </span><span class="w">    </span><span class="n">eating</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">35 </span><span class="w"> </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">36 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="70" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="112000" data-y="0" data-z="0"><h1 id="monitor-vii-other-form">Monitor(VII) Other Form</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">dP</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">thinking</span><span class="p">,</span><span class="w"> </span><span class="n">hungry</span><span class="p">,</span><span class="w"> </span><span class="n">eating</span><span class="p">}</span><span class="w">
</span><span class="ln">3 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">5 </span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hungry</span><span class="p">;</span><span class="w">  </span><span class="n">test</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="ln">9 </span><span class="w">      </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="n">test</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">test</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">16 </span><span class="w">  </span><span class="n">dP</span><span class="p">(){</span><span class="w">
</span><span class="ln">17 </span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="ln">18 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="n">thinking</span><span class="p">;</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">21 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="p">)</span><span class="w">
</span><span class="ln">23 </span><span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hungry</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w">
</span><span class="ln">24 </span><span class="w">        </span><span class="p">(</span><span class="n">state</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="mi">5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eating</span><span class="p">))</span><span class="w">
</span><span class="ln">25 </span><span class="w">    </span><span class="p">{</span><span class="w">
</span><span class="ln">26 </span><span class="w">      </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eating</span><span class="p">;</span><span class="w">
</span><span class="ln">27 </span><span class="w">      </span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">28 </span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="ln">29 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">32 </span><span class="w">   </span><span class="k">do</span><span class="p">{</span><span class="c1">//thinking
</span><span class="ln">33 </span><span class="c1"></span><span class="w">      </span><span class="n">dP</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">     </span><span class="c1">// eating
</span><span class="ln">34 </span><span class="c1"></span><span class="w">      </span><span class="n">dP</span><span class="p">.</span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">35 </span><span class="w">   </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">36 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="71" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="113600" data-y="0" data-z="0"><h1 id="monitor-viii-bounded-buffer">Monitor(VIII) Bounded Buffer</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">notfull</span><span class="p">,</span><span class="w"> </span><span class="n">notempty</span><span class="p">;</span><span class="w">  
</span><span class="ln">3 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">nextin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">nextout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">notfull</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w"> 
</span><span class="ln">6 </span><span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextin</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">nextin</span><span class="o">=</span><span class="p">(</span><span class="n">nextin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">;</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w"> 
</span><span class="ln">9 </span><span class="w">    </span><span class="n">notempty</span><span class="p">.</span><span class="n">signal</span><span class="p">();</span><span class="w"> 
</span><span class="ln">10 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="nf">take</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">notempty</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w"> 
</span><span class="ln">13 </span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">buffer</span><span class="p">[</span><span class="n">nextout</span><span class="p">];</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">nextout</span><span class="o">=</span><span class="p">(</span><span class="n">nextout</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">count</span><span class="o">--</span><span class="p">;</span><span class="w"> 
</span><span class="ln">16 </span><span class="w">    </span><span class="n">notfull</span><span class="p">.</span><span class="n">signal</span><span class="p">();</span><span class="w"> 
</span><span class="ln">17 </span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w">
</span><span class="ln">18 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">20 </span><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">22 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">23 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span><span class="w">  
</span><span class="ln">24 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">
</span><span class="ln">25 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">27 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">28 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">29 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">30 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mp</span><span class="p">.</span><span class="n">take</span><span class="p">();</span><span class="w">  
</span><span class="ln">31 </span><span class="w">    </span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> 
</span><span class="ln">32 </span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">33 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="72" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="115200" data-y="0" data-z="0"><h1 id="monitor-ix-better-bounded-buffer">Monitor(IX) better Bounded Buffer</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">notfull</span><span class="p">,</span><span class="w"> </span><span class="n">notempty</span><span class="p">;</span><span class="w">  
</span><span class="ln">3 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeAppend</span><span class="p">()</span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="p">{</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">notfull</span><span class="p">.</span><span class="n">wait</span><span class="p">();}</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterAppend</span><span class="p">()</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="p">{</span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">notempty</span><span class="p">.</span><span class="n">signal</span><span class="p">();}</span><span class="w">
</span><span class="ln">8 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeTake</span><span class="p">()</span><span class="w">
</span><span class="ln">9 </span><span class="w">  </span><span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">notempty</span><span class="p">.</span><span class="n">wait</span><span class="p">();}</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterTake</span><span class="p">()</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="p">{</span><span class="n">count</span><span class="o">--</span><span class="p">;</span><span class="n">notfull</span><span class="p">.</span><span class="n">signal</span><span class="p">();}</span><span class="w">
</span><span class="ln">12 </span><span class="w"></span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">13 </span><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">14 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nextin</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">16 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span><span class="w">  
</span><span class="ln">17 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">beforeAppend</span><span class="p">();</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextin</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">19 </span><span class="w">    </span><span class="n">afterAppend</span><span class="p">()</span><span class="w">
</span><span class="ln">20 </span><span class="w">    </span><span class="n">nextin</span><span class="o">=</span><span class="p">(</span><span class="n">nextin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">22 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">24 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nextout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">25 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">26 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">beforeTake</span><span class="p">();</span><span class="w">  
</span><span class="ln">27 </span><span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="n">buffer</span><span class="p">[</span><span class="n">nextout</span><span class="p">];</span><span class="w">
</span><span class="ln">28 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">afterTake</span><span class="p">();</span><span class="w">  
</span><span class="ln">29 </span><span class="w">    </span><span class="n">nextout</span><span class="o">=</span><span class="p">(</span><span class="n">nextout</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">;</span><span class="w">
</span><span class="ln">30 </span><span class="w">    </span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> 
</span><span class="ln">31 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">32 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="73" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="116800" data-y="0" data-z="0"><h1 id="monitor-xii-priority">Monitor(XII) Priority</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">3 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">chopstick</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="kt">bool</span><span class="w">  </span><span class="n">ach</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nb">false</span><span class="p">,</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="nb">false</span><span class="p">};</span><span class="w">
</span><span class="ln">8 </span><span class="w">
</span><span class="ln">9 </span><span class="w">  </span><span class="n">pickup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">count_m</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">count_m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> 
</span><span class="ln">12 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w">  
</span><span class="ln">14 </span><span class="w">      </span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">wait</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">16 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> 
</span><span class="ln">17 </span><span class="w">      </span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">wait</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">20 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="n">ach</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">23 </span><span class="w">    </span><span class="n">ach</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">
</span><span class="ln">24 </span><span class="w">    </span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">].</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">25 </span><span class="w">    </span><span class="n">count_m</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">26 </span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">count_m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  
</span><span class="ln">27 </span><span class="w">      </span><span class="n">mutex</span><span class="p">.</span><span class="n">signal</span><span class="p">();</span><span class="w">
</span><span class="ln">28 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">29 </span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="ln">30 </span><span class="w">
</span><span class="ln">31 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">32 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w">
</span><span class="ln">33 </span><span class="w">    </span><span class="n">thinking</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">34 </span><span class="w">    </span><span class="n">eating</span><span class="p">();</span><span class="w"> </span><span class="n">dP</span><span class="p">.</span><span class="n">putdown</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span><span class="ln">35 </span><span class="w"> </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">36 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="74" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="118400" data-y="0" data-z="0"><h1 id="monitor-xiii-notify">Monitor(XIII) notify</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">notfull</span><span class="p">,</span><span class="w"> </span><span class="n">notempty</span><span class="p">;</span><span class="w">  
</span><span class="ln">3 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nextin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nextout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">notfull</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextin</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">nextin</span><span class="o">=</span><span class="p">(</span><span class="n">nextin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">;</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w">    </span><span class="n">notempty</span><span class="p">.</span><span class="n">notify</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="nf">take</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">notempty</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextout</span><span class="p">];</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">nextout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">nextout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">count</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">16 </span><span class="w">    </span><span class="n">notfull</span><span class="p">.</span><span class="n">notify</span><span class="p">();</span><span class="w">
</span><span class="ln">17 </span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w">
</span><span class="ln">18 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">20 </span><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">22 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span><span class="w">  
</span><span class="ln">23 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">
</span><span class="ln">24 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">27 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">28 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mp</span><span class="p">.</span><span class="n">take</span><span class="p">();</span><span class="w">  
</span><span class="ln">29 </span><span class="w">    </span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> 
</span><span class="ln">30 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="75" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="120000" data-y="0" data-z="0"><h1 id="monitor-xiii-notify-1">Monitor(XIII) notify</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="n">monitor</span><span class="w"> </span><span class="n">mp</span><span class="p">{</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">condition</span><span class="w"> </span><span class="n">notfull</span><span class="p">,</span><span class="w"> </span><span class="n">notempty</span><span class="p">;</span><span class="w">  
</span><span class="ln">3 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nextin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nextout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w">
</span><span class="ln">5 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">notfull</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">6 </span><span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextin</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">    </span><span class="n">nextin</span><span class="o">=</span><span class="p">(</span><span class="n">nextin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">N</span><span class="p">;</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w">    </span><span class="n">notempty</span><span class="p">.</span><span class="n">notify</span><span class="p">();</span><span class="w">
</span><span class="ln">10 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="nf">take</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">notempty</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">nextout</span><span class="p">];</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">nextout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">nextout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w">
</span><span class="ln">15 </span><span class="w">    </span><span class="n">count</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">16 </span><span class="w">    </span><span class="n">notfull</span><span class="p">.</span><span class="n">notify</span><span class="p">();</span><span class="w">
</span><span class="ln">17 </span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w">
</span><span class="ln">18 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">19 </span><span class="w"></span><span class="p">};</span></pre><pre class="highlight code cpp"><span class="ln">20 </span><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">22 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span><span class="w">  
</span><span class="ln">23 </span><span class="w">    </span><span class="n">mp</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">
</span><span class="ln">24 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">26 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">27 </span><span class="w">  </span><span class="k">do</span><span class="p">{</span><span class="w"> 
</span><span class="ln">28 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mp</span><span class="p">.</span><span class="n">take</span><span class="p">();</span><span class="w">  
</span><span class="ln">29 </span><span class="w">    </span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> 
</span><span class="ln">30 </span><span class="w">  </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">31 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="76" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="121600" data-y="0" data-z="0"><h1 id="monitor-implementation-by-semaphore">Monitor implementation by Semaphore</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="w">  </span><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w">  </span><span class="n">semaphore</span><span class="w"> </span><span class="n">next</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> 
</span><span class="ln">3 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">next_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="cm">/* Each external 
</span><span class="ln">6 </span><span class="cm"> * procedure F will 
</span><span class="ln">7 </span><span class="cm"> * be replaced by */</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">mutex</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">
</span><span class="ln">9 </span><span class="w"></span><span class="c1">//    body of F;
</span><span class="ln">10 </span><span class="c1"></span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">next_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">next</span><span class="p">.</span><span class="n">V</span><span class="p">()</span><span class="w">
</span><span class="ln">12 </span><span class="w">  </span><span class="k">else</span><span class="w">  </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">13 </span><span class="w">
</span><span class="ln">14 </span><span class="w"></span><span class="cm">/* For each condition
</span><span class="ln">15 </span><span class="cm"> *  variable x, we  have:*/</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span><span class="n">semaphore</span><span class="w"> </span><span class="n">x_sem</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">  
</span><span class="ln">17 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="o">-</span><span class="n">_ount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></pre><pre class="highlight code cpp"><span class="ln">18 </span><span class="cm">/* The operation x.wait 
</span><span class="ln">19 </span><span class="cm"> * can be implemented as:*/</span><span class="w">
</span><span class="ln">20 </span><span class="w">  </span><span class="n">x</span><span class="o">-</span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next</span><span class="o">-</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">     
</span><span class="ln">22 </span><span class="w">    </span><span class="n">next</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">23 </span><span class="w">  </span><span class="k">else</span><span class="w">
</span><span class="ln">24 </span><span class="w">    </span><span class="n">mutex</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">
</span><span class="ln">25 </span><span class="w">  </span><span class="n">x_sem</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">      
</span><span class="ln">26 </span><span class="w">  </span><span class="n">x_count</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">27 </span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="cm">/* The operation x.signal 
</span><span class="ln">29 </span><span class="cm"> * can be implemented as:*/</span><span class="w">
</span><span class="ln">30 </span><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
</span><span class="ln">31 </span><span class="w">  </span><span class="n">next_count</span><span class="o">++</span><span class="p">;</span><span class="w">  
</span><span class="ln">32 </span><span class="w">  </span><span class="n">x_sem</span><span class="p">.</span><span class="n">V</span><span class="p">();</span><span class="w">  
</span><span class="ln">33 </span><span class="w">  </span><span class="n">next</span><span class="p">.</span><span class="n">P</span><span class="p">();</span><span class="w">   
</span><span class="ln">34 </span><span class="w">  </span><span class="n">next_count</span><span class="o">--</span><span class="p">;</span><span class="w">
</span><span class="ln">35 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="77" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="123200" data-y="0" data-z="0"><h1 id="inter-process-communication-ipc-i">Inter-process Communication (IPC) I</h1><ol><li><dl><dt>Message Passing</dt><dd><ol><li>send</li><li>receive</li></ol></dd></dl></li></ol><ul><li>direct</li><li>indirect (mailbox)</li></ul><ol><li>unidirectional</li><li>bi-directional</li></ol><ul><li>Nonblocking send</li><li>Blocking receive</li><li>Nonblocking receive</li></ul><ol><li><dl><dt>communication</dt><dd><ol><li>Symmetric</li><li>asymmetric</li></ol></dd></dl></li></ol></div><div class="step step-level-1 t2c" step="78" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="124800" data-y="0" data-z="0"><h1 id="inter-process-communication-ipc-ii">Inter-process Communication (IPC) II</h1><ul><li><dl><dt>buffering</dt><dd><ol><li>Automatic</li><li>explicit</li></ol></dd></dl></li></ul><ol><li><dl><dt>send by</dt><dd><ol><li>copy</li><li>reference</li></ol></dd></dl></li></ol><ul><li><dl><dt>Message Size</dt><dd><ol><li><dl><dt>Fixed</dt><dd><ol><li>Zero capacity</li></ol></dd></dl></li><li>variable</li></ol></dd></dl></li></ul><ol><li><dl><dt>Client-Server Communication</dt><dd><ol><li>Sockets</li><li>Remote Procedure Calls</li><li>Remote Method Invocation (Java)</li></ol></dd></dl></li></ol></div><div class="step step-level-1 t2c" step="79" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="126400" data-y="0" data-z="0"><h1 id="send-and-receive-i">Send and Receive(I)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="cm">/* const int n = 
</span><span class="ln">2 </span><span class="cm">   number of process */</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">mailbox</span><span class="w"> </span><span class="n">box</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">P</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">6 </span><span class="w">  </span><span class="n">message</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln">8 </span><span class="w">    </span><span class="n">receive</span><span class="p">(</span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w">
</span><span class="ln">9 </span><span class="w">    </span><span class="cm">/*Critical Section*/</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">send</span><span class="p">(</span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="cm">/*Remainder Section*/</span><span class="w">
</span><span class="ln">12 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">13 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">15 </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">16 </span><span class="w">  </span><span class="n">send</span><span class="p">(</span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">null</span><span class="p">);</span><span class="w">
</span><span class="ln">17 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w">
</span><span class="ln">18 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">19 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">20 </span><span class="w">    </span><span class="err">&#8230;</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w">
</span><span class="ln">22 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">23 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="80" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="128000" data-y="0" data-z="0"><h1 id="send-and-receive-ii">Send and Receive(II)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="cm">/* const int n =
</span><span class="ln">2 </span><span class="cm">  number of process 
</span><span class="ln">3 </span><span class="cm">*/</span><span class="w">
</span><span class="ln">4 </span><span class="w">
</span><span class="ln">5 </span><span class="w"></span><span class="n">mailbox</span><span class="w"> </span><span class="n">box</span><span class="p">;</span><span class="w">
</span><span class="ln">6 </span><span class="w">
</span><span class="ln">7 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">P</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w">
</span><span class="ln">8 </span><span class="w">  </span><span class="n">message</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">box</span><span class="p">.</span><span class="n">receive</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w">
</span><span class="ln">11 </span><span class="w">      </span><span class="cm">/* critical section */</span><span class="p">;</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">box</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w">
</span><span class="ln">13 </span><span class="w">      </span><span class="cm">/* remainder */</span><span class="p">;</span><span class="w">
</span><span class="ln">14 </span><span class="w">  </span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">15 </span><span class="p">}</span><span class="w">
</span><span class="ln">16 </span><span class="w">
</span><span class="ln">17 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">18 </span><span class="w">  </span><span class="n">box</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">null</span><span class="p">);</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="w">
</span><span class="ln">20 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="err">&#8230;</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">23 </span><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w">
</span><span class="ln">24 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">25 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1 t2c" step="81" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="129600" data-y="0" data-z="0"><h1 id="producer-consumer-send-and-receive">Producer consumer (Send and Receive)</h1><pre class="highlight code cpp"><span class="ln">1 </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w">  </span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="ln">2 </span><span class="w"></span><span class="n">object</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">capacity</span><span class="p">];</span><span class="w">
</span><span class="ln">3 </span><span class="w"></span><span class="n">mailbox</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mayproduce</span><span class="p">;</span><span class="w">
</span><span class="ln">4 </span><span class="w"></span><span class="n">mailbox</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mayconsume</span><span class="p">;</span><span class="w">
</span><span class="ln">5 </span><span class="w">
</span><span class="ln">6 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">(){</span><span class="w">
</span><span class="ln">7 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> 
</span><span class="ln">8 </span><span class="w">  </span><span class="n">object</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">9 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span><span class="w">
</span><span class="ln">10 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produce</span><span class="p">();</span><span class="w">
</span><span class="ln">11 </span><span class="w">    </span><span class="n">mayproduce</span><span class="p">.</span><span class="n">receive</span><span class="p">();</span><span class="w">
</span><span class="ln">12 </span><span class="w">    </span><span class="n">buf</span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="n">mayconsume</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">14 </span><span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w">
</span><span class="ln">15 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln">16 </span><span class="w"></span><span class="p">}</span></pre><pre class="highlight code cpp"><span class="ln">17 </span><span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(){</span><span class="w"> 
</span><span class="ln">18 </span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln">19 </span><span class="w">  </span><span class="n">object</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="ln">20 </span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln">21 </span><span class="w">    </span><span class="n">mayconsume</span><span class="p">.</span><span class="n">receive</span><span class="p">();</span><span class="w">
</span><span class="ln">22 </span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">out</span><span class="p">]</span><span class="w">
</span><span class="ln">23 </span><span class="w">    </span><span class="n">mayproduce</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">24 </span><span class="w">    </span><span class="n">consume</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">
</span><span class="ln">25 </span><span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w">
</span><span class="ln">26 </span><span class="w">  </span><span class="p">}</span><span class="w"> 
</span><span class="ln">27 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln">28 </span><span class="w"></span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">29 </span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> 
</span><span class="ln">30 </span><span class="w">    </span><span class="n">mayproduce</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="ln">31 </span><span class="w">  </span><span class="n">cobegin</span><span class="p">{</span><span class="n">producer</span><span class="p">();</span><span class="w"> </span><span class="n">consumer</span><span class="p">();}</span><span class="w">
</span><span class="ln">32 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1" step="82" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="131200" data-y="0" data-z="0"><h1 id="c-20-synchronized">C++20 Synchronized</h1><pre class="highlight code cpp"><span class="ln"> 1 </span><span class="kt">int</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="ln"> 2 </span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="ln"> 3 </span><span class="w">  </span><span class="n">synchronized</span><span class="p">{</span><span class="w">
</span><span class="ln"> 4 </span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Not interleaved </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w">
</span><span class="ln"> 5 </span><span class="w">    </span><span class="o">++</span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln"> 6 </span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="ln"> 7 </span><span class="w">  </span><span class="p">}</span><span class="w">
</span><span class="ln"> 8 </span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="ln"> 9 </span><span class="w">
</span><span class="ln">10 </span><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
</span><span class="ln">11 </span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">
</span><span class="ln">12 </span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w">
</span><span class="ln">13 </span><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">([]{</span><span class="w"> </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">func</span><span class="p">();</span><span class="w"> </span><span class="p">});</span><span class="w">
</span><span class="ln">14 </span><span class="w"></span><span class="p">}</span></pre></div><div class="step step-level-1" step="83" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="132800" data-y="0" data-z="0"><h1 id="c-20-synchronized-1">C++20 Synchronized</h1><pre class="highlight code cpp"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span><span class="cp">
#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span><span class="cp">
#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span><span class="cp">
</span><span class="w">
</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">g_display_mutex</span><span class="p">;</span><span class="w">

</span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(){</span><span class="w">
  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">id</span><span class="w"> </span><span class="n">this_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">get_id</span><span class="p">();</span><span class="w">

  </span><span class="n">g_display_mutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span><span class="w">
  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"thread "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">this_id</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" sleeping...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w">
  </span><span class="n">g_display_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span><span class="w">

  </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w">
  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w">
  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t2</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w">
  </span><span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span><span class="w">
  </span><span class="n">t2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span><span class="w">
</span><span class="p">}</span></pre></div><div class="step step-level-1" step="84" style="width: 1024px;" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="134400" data-y="0" data-z="0"><h1 id="end">END</h1></div></div><div id="slide-number" class="slide-number">
         1
      </div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript" src="js/MathJax/es5/tex-mml-chtml.js"></script><script type="text/javascript">
      document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
    </script></body></html>